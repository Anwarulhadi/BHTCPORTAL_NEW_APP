import{r as a,j as e,D as z,a as V,b as K,L as H,d as q,I,B as D,E as Z,e as ee,f as te,g as se,M as R,N as re,X as ae,F as ne,G as oe,H as ie,J as le,K as ce,S as de,C as ue}from"./index-CsIQr1_W.js";import{L as B}from"./label-B-ZXoVCc.js";import{A as he}from"./arrow-left-bE1pyDdF.js";const fe=({open:n,onOpenChange:w,onSuccess:u})=>{const[y,N]=a.useState(""),[b,m]=a.useState(""),[x,j]=a.useState(!1),[s,r]=a.useState(!1),[l,d]=a.useState("");a.useEffect(()=>{if(n){const c={modal:"auth"};window.history.pushState(c,"",window.location.href);const i=f=>{w(!1)};return window.addEventListener("popstate",i),()=>{window.removeEventListener("popstate",i)}}},[n]);const p=()=>{var c;((c=window.history.state)==null?void 0:c.modal)==="auth"?window.history.back():w(!1)},h=async c=>{if(c.preventDefault(),d(""),b.length!==4){d("Password must be exactly 4 digits");return}j(!0);try{const{data:i,error:f}=await se.verifyStudentPassword(y,b);f||!i?(d("Invalid Student ID or Password"),R.error("Authentication failed")):(R.success("Access Granted"),u(),p())}catch(i){console.error("Login error:",i),d("An error occurred. Please try again.")}finally{j(!1)}};return e.jsx(z,{open:n,onOpenChange:w,children:e.jsxs(V,{className:"sm:max-w-[425px]",children:[e.jsxs(K,{children:[e.jsx("div",{className:"mx-auto mb-2 p-3 bg-primary/10 rounded-full w-fit",children:e.jsx(H,{className:"w-8 h-8 text-primary"})}),e.jsx(q,{className:"text-center text-2xl font-bold",children:"Module Access"})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"studentId",children:"Student ID"}),e.jsx(I,{id:"studentId",placeholder:"Enter your Student ID",value:y,onChange:c=>N(c.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{id:"password",type:s?"text":"password",placeholder:"Enter your password",value:b,onChange:c=>m(c.target.value),required:!0,maxLength:4,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx(D,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>r(!s),children:s?e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})})]})]}),l&&e.jsx("p",{className:"text-sm text-red-500 text-center font-medium",children:l}),e.jsx(D,{type:"submit",className:"w-full",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"mr-2 h-4 w-4 animate-spin"}),"Verifying..."]}):"Access Module"})]})]})})},T=n=>Math.min(3,Math.max(.75,n)),me=({open:n,onOpenChange:w,module:u})=>{const[y,N]=a.useState(1),[b,m]=a.useState(!1),x=a.useRef(null);a.useEffect(()=>{if(!n)return;const s=r=>r.preventDefault();return document.addEventListener("contextmenu",s),()=>document.removeEventListener("contextmenu",s)},[n]),a.useEffect(()=>{if(!n)return;const s=r=>r.preventDefault();return document.addEventListener("copy",s),()=>document.removeEventListener("copy",s)},[n]),a.useEffect(()=>{if(!n)return;const s=r=>{(r.ctrlKey||r.metaKey)&&(r.key==="p"||r.key==="s"||r.key==="c")&&r.preventDefault()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[n]),a.useEffect(()=>{if(!n)return;const s=async r=>{var p;const l=r.key.toLowerCase();if(l==="printscreen"||l==="f12"||(r.ctrlKey||r.metaKey)&&r.shiftKey&&l==="s"){r.preventDefault();try{await((p=navigator.clipboard)==null?void 0:p.writeText("Screenshots are disabled in protected view."))}catch{}m(!0),setTimeout(()=>m(!1),1200)}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[n]),a.useEffect(()=>{if(!n||!u)return;const s={modal:"moduleReader"};window.history.pushState(s,"",window.location.href);const r=()=>{w(!1)};return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[n,w,u]),a.useEffect(()=>{n&&(N(1),m(!1))},[n,u]),a.useEffect(()=>{if(!n)return;const s=()=>{document.visibilityState==="hidden"?m(!0):m(!1)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[n]),a.useEffect(()=>{const s=x.current;if(!s)return;const r=new Map;let l=0;const d=()=>{if(r.size!==2)return 0;const[i,f]=Array.from(r.values()),S=i.clientX-f.clientX,k=i.clientY-f.clientY;return Math.hypot(S,k)},p=i=>{i.pointerType==="touch"&&(r.set(i.pointerId,i),r.size===2&&(l=d()))},h=i=>{if(r.has(i.pointerId)&&(r.set(i.pointerId,i),r.size===2&&l)){i.preventDefault();const f=d();f&&(N(S=>T(S*(f/l))),l=f)}},c=i=>{r.delete(i.pointerId),r.size<2&&(l=0)};return s.addEventListener("pointerdown",p,{passive:!1,capture:!0}),s.addEventListener("pointermove",h,{passive:!1,capture:!0}),s.addEventListener("pointerup",c,{capture:!0}),s.addEventListener("pointercancel",c,{capture:!0}),()=>{s.removeEventListener("pointerdown",p,!0),s.removeEventListener("pointermove",h,!0),s.removeEventListener("pointerup",c,!0),s.removeEventListener("pointercancel",c,!0)}},[]),a.useEffect(()=>{const s=x.current;if(!s)return;const r=l=>{l.ctrlKey&&(l.preventDefault(),N(d=>T(d-l.deltaY*.0015)))};return s.addEventListener("wheel",r,{passive:!1}),()=>s.removeEventListener("wheel",r)},[]);const j=()=>{var s;w(!1),((s=window.history.state)==null?void 0:s.modal)==="moduleReader"&&window.history.back()};return u?e.jsx(z,{open:n,onOpenChange:s=>!s&&j(),children:e.jsxs(V,{className:"w-screen h-screen max-w-none m-0 p-0 rounded-none border-0 bg-slate-900 overflow-hidden",children:[e.jsx(K,{className:"sr-only",children:e.jsx(q,{children:u.title})}),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-800 text-white z-10 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-widest text-slate-200",children:[e.jsx(re,{className:"w-4 h-4 text-emerald-300"}),"Protected View"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-xs font-semibold text-slate-200",children:[Math.round(y*100),"%"]}),e.jsx(D,{variant:"ghost",size:"icon",onClick:j,children:e.jsx(ae,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{ref:x,className:"flex-1 relative bg-white select-none overflow-hidden touch-none",onDragStart:s=>s.preventDefault(),children:[e.jsx("div",{className:"w-full h-full",style:{transform:`scale(${y})`,transformOrigin:"top center",transition:"transform 100ms ease-out"},children:e.jsx("iframe",{src:`https://docs.google.com/gview?url=${encodeURIComponent(u.file_url)}&embedded=true`,className:"w-full h-full border-0 pointer-events-auto",title:u.title,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups",allow:"clipboard-read; clipboard-write",draggable:!1})}),b&&e.jsxs("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur flex flex-col items-center justify-center text-white text-sm font-semibold z-50",children:["Secure mode active",e.jsx("span",{className:"text-xs font-normal mt-1 opacity-80",children:"Resume reading to continue"})]})]})]})]})}):null},we=()=>{const[n,w]=a.useState([]),[u,y]=a.useState([]),[N,b]=a.useState(!0),m=ne(),[x,j]=oe(),s=x.get("category"),r=x.get("highlight"),l=x.get("sub");ie();const[d,p]=a.useState(""),[h,c]=a.useState(l||"All"),[i,f]=a.useState(null),[S,k]=a.useState(!1),[M,A]=a.useState(!1),[F,O]=a.useState(!1),[v,C]=a.useState(r),_=a.useRef({}),$=a.useCallback(async()=>M||S?!1:(m("/",{state:{scrollTo:"module-section"}}),!0),[M,S,m]);le($),a.useEffect(()=>{U()},[s]),a.useEffect(()=>{C(r)},[r]),a.useEffect(()=>{l&&c(l)},[l]),a.useEffect(()=>{let t=n;if(h&&h!=="All"&&(t=t.filter(o=>o.sub_category===h)),d){const o=d.toLowerCase();t=t.filter(g=>g.title.toLowerCase().includes(o))}y(t)},[n,d,h]);const U=async()=>{b(!0);try{let t=ce.from("modules").select("*").eq("is_visible",!0).order("order_index",{ascending:!0});const{data:o,error:g}=await t;if(g)throw g;let L=o||[];s&&(L=L.filter(E=>E.course_category===s||E.sub_category===s||s==="Vision"&&E.course_category==="Vision")),w(L),y(L)}catch(t){console.error("Error fetching modules:",t)}finally{b(!1)}},G=t=>{f(t),C(t.id);const o=new URLSearchParams(x);o.set("highlight",t.id),t.course_category&&o.set("category",t.course_category),j(o),F?A(!0):k(!0)},X=()=>{O(!0),k(!1),A(!0)},Y=()=>{p(""),c("All"),C(null),f(null),j(new URLSearchParams),m("/"),setTimeout(()=>{const t=document.getElementById("text-documents-section");t&&t.scrollIntoView({behavior:"smooth"})},100)};a.useEffect(()=>{if(!v)return;const t=n.find(g=>g.id===v);if(!t)return;const o=t.sub_category||"All";h!=="All"&&h!==o&&c(o)},[v,n,h]),a.useEffect(()=>{if(v){const t=setTimeout(()=>{C(null)},3e3);return()=>clearTimeout(t)}},[v]),a.useEffect(()=>{if(!v)return;const t=_.current[v];t&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},[v,u]);let P=[];if(s==="Vision"||s==="Cinematography"){const t=[...new Set(n.filter(o=>o.course_category===s).map(o=>o.sub_category).filter(Boolean).filter(o=>o!=="None"))];t.length>0?P=["All",...t]:P=["All"]}else P=["All",...new Set(n.map(t=>t.sub_category).filter(Boolean).filter(t=>t!=="None"))];const Q=({text:t,highlight:o})=>{if(!o.trim())return e.jsx("span",{children:t});const g=new RegExp(`(${o})`,"gi"),L=t.split(g);return e.jsx("span",{children:L.map((E,W)=>g.test(E)?e.jsx("span",{className:"bg-yellow-200 text-black",children:E},W):E)})},J=()=>s==="Cinematography"?"Cinematography Text Documents":s==="Vision"?"Vision & Sound Editing Text Documents":"All Modules";return e.jsxs("div",{className:"min-h-screen bg-background p-4 sm:p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(D,{variant:"ghost",className:"w-fit pl-0 hover:bg-transparent hover:text-primary",onClick:Y,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Back to Home"]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-primary uppercase",children:J()}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[u.length," modules available"]})]}),e.jsxs("div",{className:"relative w-full md:w-72",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search modules...",value:d,onChange:t=>p(t.target.value),className:"pl-9"})]})]}),P.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(t=>{let o=t;return t==="Basic Premiere Pro"&&(o="PREMIERE PRO"),(t==="Basic Photoshop"||t==="Photoshop")&&(o="PHOTOSHOP"),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>{c(t)},className:`rounded-md font-semibold uppercase border-0 shadow-sm ${h===t?"bg-emerald-600 text-white hover:bg-emerald-700 hover:text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:o},t)})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 sm:gap-6",children:u.map(t=>{const o=v===t.id;return e.jsxs(ue,{ref:g=>{_.current[t.id]=g},className:`group cursor-pointer transition-all duration-300 border-0 bg-white overflow-hidden ${o?"ring-4 ring-emerald-500 ring-offset-2 ring-offset-background shadow-2xl scale-105":"shadow-md hover:scale-105"}`,onClick:()=>G(t),children:[e.jsx("div",{className:"p-3 pb-0",children:e.jsxs("div",{className:"aspect-[2/3] relative rounded-md overflow-hidden shadow-sm",children:[e.jsx("img",{src:t.course_category==="Cinematography"?"/book_cover_138.png":"/book_cover_137.png",alt:t.title,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-2",children:e.jsx("h3",{className:"text-emerald-600 font-bold text-center text-sm sm:text-base leading-tight drop-shadow-sm bg-white/80 p-1 rounded",children:t.title})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:e.jsx(H,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg"})})]})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-semibold text-sm truncate text-center text-gray-900",title:t.title,children:e.jsx(Q,{text:t.title,highlight:d})}),t.sub_category&&e.jsx("p",{className:"text-xs text-center text-muted-foreground mt-1 truncate",children:t.sub_category}),o&&e.jsx("p",{className:"text-[11px] text-center text-emerald-600 font-semibold mt-2 animate-pulse",children:"Selected from home"})]})]},t.id)})}),u.length===0&&!N&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground text-lg",children:"There are no module files available"})})]}),e.jsx(fe,{open:S,onOpenChange:k,onSuccess:X}),e.jsx(me,{open:M,onOpenChange:A,module:i})]})};export{we as default};
