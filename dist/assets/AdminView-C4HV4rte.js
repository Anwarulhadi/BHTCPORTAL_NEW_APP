import{c as Ke,k as js,r,m as Fe,u as Bt,j as e,P as xe,l as pe,o as Fr,p as Te,R as se,i as Or,O as Ws,Q as Br,t as et,T as Js,U as $r,V as Ur,W as Vr,Y as zr,Z as Hr,_ as Gr,$ as zt,a0 as qr,a1 as Xr,s as Kr,n as Zs,a2 as Yr,a3 as Wr,a4 as Jr,a5 as Zr,H as tt,J as Ht,g as Ee,M as v,C as Ie,B as P,a6 as ct,a7 as Me,a8 as Xe,D as we,a as ve,b as Se,d as _e,I as G,a9 as Vs,aa as $t,X as dt,ab as ds,ac as Qs,ad as Qr,ae as en,q as tn,K as k,af as ys,ag as Ns,x as Cs,y as sn,e as Le,E as He,ah as an,ai as rn,aj as nn,L as us,ak as on,al as ln,am as It,an as cn,ao as dn,ap as is,S as un,aq as zs,ar as Hs,as as Gs,at as Lt,au as Ft,av as hn,aw as mn,ax as pn,ay as gn,az as xn,aA as fn,aB as wn}from"./index-CsIQr1_W.js";import{u as ea,c as qs}from"./index-szPH3Lut.js";import{L as De}from"./label-B-ZXoVCc.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=Ke("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=Ke("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=Ke("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=Ke("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=Ke("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=Ke("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=Ke("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=Ke("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=Ke("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var Gt="Switch",[bn,So]=js(Gt),[jn,yn]=bn(Gt),aa=r.forwardRef((t,a)=>{const{__scopeSwitch:s,name:d,checked:n,defaultChecked:o,required:u,disabled:h,value:c="on",onCheckedChange:l,form:f,...g}=t,[C,N]=r.useState(null),I=Fe(a,R=>N(R)),_=r.useRef(!1),D=C?f||!!C.closest("form"):!0,[S,A]=Bt({prop:n,defaultProp:o??!1,onChange:l,caller:Gt});return e.jsxs(jn,{scope:s,checked:S,disabled:h,children:[e.jsx(xe.button,{type:"button",role:"switch","aria-checked":S,"aria-required":u,"data-state":ia(S),"data-disabled":h?"":void 0,disabled:h,value:c,...g,ref:I,onClick:pe(t.onClick,R=>{A(L=>!L),D&&(_.current=R.isPropagationStopped(),_.current||R.stopPropagation())})}),D&&e.jsx(oa,{control:C,bubbles:!_.current,name:d,value:c,checked:S,required:u,disabled:h,form:f,style:{transform:"translateX(-100%)"}})]})});aa.displayName=Gt;var ra="SwitchThumb",na=r.forwardRef((t,a)=>{const{__scopeSwitch:s,...d}=t,n=yn(ra,s);return e.jsx(xe.span,{"data-state":ia(n.checked),"data-disabled":n.disabled?"":void 0,...d,ref:a})});na.displayName=ra;var Nn="SwitchBubbleInput",oa=r.forwardRef(({__scopeSwitch:t,control:a,checked:s,bubbles:d=!0,...n},o)=>{const u=r.useRef(null),h=Fe(u,o),c=ea(s),l=Fr(a);return r.useEffect(()=>{const f=u.current;if(!f)return;const g=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(g,"checked").set;if(c!==s&&N){const I=new Event("click",{bubbles:d});N.call(f,s),f.dispatchEvent(I)}},[c,s,d]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...n,tabIndex:-1,ref:h,style:{...n.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});oa.displayName=Nn;function ia(t){return t?"checked":"unchecked"}var la=aa,Cn=na;const Es=r.forwardRef(({className:t,...a},s)=>e.jsx(la,{className:Te("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",t),...a,ref:s,children:e.jsx(Cn,{className:Te("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Es.displayName=la.displayName;var Sn=Object.defineProperty,_n=(t,a,s)=>a in t?Sn(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,de=(t,a,s)=>_n(t,typeof a!="symbol"?a+"":a,s);const Ut={x:0,y:0,width:0,height:0,unit:"px"},bt=(t,a,s)=>Math.min(Math.max(t,a),s),Pn=(...t)=>t.filter(a=>a&&typeof a=="string").join(" "),Xs=(t,a)=>t===a||t.width===a.width&&t.height===a.height&&t.x===a.x&&t.y===a.y&&t.unit===a.unit;function jt(t,a,s){return t.unit==="%"?{...Ut,...t,unit:"%"}:{unit:"%",x:t.x?t.x/a*100:0,y:t.y?t.y/s*100:0,width:t.width?t.width/a*100:0,height:t.height?t.height/s*100:0}}function We(t,a,s){return t.unit?t.unit==="px"?{...Ut,...t,unit:"px"}:{unit:"px",x:t.x?t.x*a/100:0,y:t.y?t.y*s/100:0,width:t.width?t.width*a/100:0,height:t.height?t.height*s/100:0}:{...Ut,...t,unit:"px"}}function Ks(t,a,s,d,n,o=0,u=0,h=d,c=n){const l={...t};let f=Math.min(o,d),g=Math.min(u,n),C=Math.min(h,d),N=Math.min(c,n);a&&(a>1?(f=u?u*a:f,g=f/a,C=h*a):(g=o?o/a:g,f=g*a,N=c/a)),l.y<0&&(l.height=Math.max(l.height+l.y,g),l.y=0),l.x<0&&(l.width=Math.max(l.width+l.x,f),l.x=0);const I=d-(l.x+l.width);I<0&&(l.x=Math.min(l.x,d-f),l.width+=I);const _=n-(l.y+l.height);if(_<0&&(l.y=Math.min(l.y,n-g),l.height+=_),l.width<f&&((s==="sw"||s=="nw")&&(l.x-=f-l.width),l.width=f),l.height<g&&((s==="nw"||s=="ne")&&(l.y-=g-l.height),l.height=g),l.width>C&&((s==="sw"||s=="nw")&&(l.x-=C-l.width),l.width=C),l.height>N&&((s==="nw"||s=="ne")&&(l.y-=N-l.height),l.height=N),a){const D=l.width/l.height;if(D<a){const S=Math.max(l.width/a,g);(s==="nw"||s=="ne")&&(l.y-=S-l.height),l.height=S}else if(D>a){const S=Math.max(l.height*a,f);(s==="sw"||s=="nw")&&(l.x-=S-l.width),l.width=S}}return l}function En(t,a,s,d){const n={...t};return a==="ArrowLeft"?d==="nw"?(n.x-=s,n.y-=s,n.width+=s,n.height+=s):d==="w"?(n.x-=s,n.width+=s):d==="sw"?(n.x-=s,n.width+=s,n.height+=s):d==="ne"?(n.y+=s,n.width-=s,n.height-=s):d==="e"?n.width-=s:d==="se"&&(n.width-=s,n.height-=s):a==="ArrowRight"&&(d==="nw"?(n.x+=s,n.y+=s,n.width-=s,n.height-=s):d==="w"?(n.x+=s,n.width-=s):d==="sw"?(n.x+=s,n.width-=s,n.height-=s):d==="ne"?(n.y-=s,n.width+=s,n.height+=s):d==="e"?n.width+=s:d==="se"&&(n.width+=s,n.height+=s)),a==="ArrowUp"?d==="nw"?(n.x-=s,n.y-=s,n.width+=s,n.height+=s):d==="n"?(n.y-=s,n.height+=s):d==="ne"?(n.y-=s,n.width+=s,n.height+=s):d==="sw"?(n.x+=s,n.width-=s,n.height-=s):d==="s"?n.height-=s:d==="se"&&(n.width-=s,n.height-=s):a==="ArrowDown"&&(d==="nw"?(n.x+=s,n.y+=s,n.width-=s,n.height-=s):d==="n"?(n.y+=s,n.height-=s):d==="ne"?(n.y+=s,n.width-=s,n.height-=s):d==="sw"?(n.x-=s,n.width+=s,n.height+=s):d==="s"?n.height+=s:d==="se"&&(n.width+=s,n.height+=s)),n}const yt={capture:!0,passive:!1};let In=0;const Je=class Ve extends r.PureComponent{constructor(){super(...arguments),de(this,"docMoveBound",!1),de(this,"mouseDownOnCrop",!1),de(this,"dragStarted",!1),de(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),de(this,"componentRef",r.createRef()),de(this,"mediaRef",r.createRef()),de(this,"resizeObserver"),de(this,"initChangeCalled",!1),de(this,"instanceId",`rc-${In++}`),de(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),de(this,"onCropPointerDown",a=>{const{crop:s,disabled:d}=this.props,n=this.getBox();if(!s)return;const o=We(s,n.width,n.height);if(d)return;a.cancelable&&a.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const u=a.target.dataset.ord,h=!!u;let c=a.clientX,l=a.clientY,f=o.x,g=o.y;if(u){const C=a.clientX-n.x,N=a.clientY-n.y;let I=0,_=0;u==="ne"||u=="e"?(I=C-(o.x+o.width),_=N-o.y,f=o.x,g=o.y+o.height):u==="se"||u==="s"?(I=C-(o.x+o.width),_=N-(o.y+o.height),f=o.x,g=o.y):u==="sw"||u=="w"?(I=C-o.x,_=N-(o.y+o.height),f=o.x+o.width,g=o.y):(u==="nw"||u=="n")&&(I=C-o.x,_=N-o.y,f=o.x+o.width,g=o.y+o.height),c=f+n.x+I,l=g+n.y+_}this.evData={startClientX:c,startClientY:l,startCropX:f,startCropY:g,clientX:a.clientX,clientY:a.clientY,isResize:h,ord:u},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),de(this,"onComponentPointerDown",a=>{const{crop:s,disabled:d,locked:n,keepSelection:o,onChange:u}=this.props,h=this.getBox();if(d||n||o&&s)return;a.cancelable&&a.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const c=a.clientX-h.x,l=a.clientY-h.y,f={unit:"px",x:c,y:l,width:0,height:0};this.evData={startClientX:a.clientX,startClientY:a.clientY,startCropX:c,startCropY:l,clientX:a.clientX,clientY:a.clientY,isResize:!0},this.mouseDownOnCrop=!0,u(We(f,h.width,h.height),jt(f,h.width,h.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),de(this,"onDocPointerMove",a=>{const{crop:s,disabled:d,onChange:n,onDragStart:o}=this.props,u=this.getBox();if(d||!s||!this.mouseDownOnCrop)return;a.cancelable&&a.preventDefault(),this.dragStarted||(this.dragStarted=!0,o&&o(a));const{evData:h}=this;h.clientX=a.clientX,h.clientY=a.clientY;let c;h.isResize?c=this.resizeCrop():c=this.dragCrop(),Xs(s,c)||n(We(c,u.width,u.height),jt(c,u.width,u.height))}),de(this,"onComponentKeyDown",a=>{const{crop:s,disabled:d,onChange:n,onComplete:o}=this.props;if(d)return;const u=a.key;let h=!1;if(!s)return;const c=this.getBox(),l=this.makePixelCrop(c),f=(navigator.platform.match("Mac")?a.metaKey:a.ctrlKey)?Ve.nudgeStepLarge:a.shiftKey?Ve.nudgeStepMedium:Ve.nudgeStep;if(u==="ArrowLeft"?(l.x-=f,h=!0):u==="ArrowRight"?(l.x+=f,h=!0):u==="ArrowUp"?(l.y-=f,h=!0):u==="ArrowDown"&&(l.y+=f,h=!0),h){a.cancelable&&a.preventDefault(),l.x=bt(l.x,0,c.width-l.width),l.y=bt(l.y,0,c.height-l.height);const g=We(l,c.width,c.height),C=jt(l,c.width,c.height);n(g,C),o&&o(g,C)}}),de(this,"onHandlerKeyDown",(a,s)=>{const{aspect:d=0,crop:n,disabled:o,minWidth:u=0,minHeight:h=0,maxWidth:c,maxHeight:l,onChange:f,onComplete:g}=this.props,C=this.getBox();if(o||!n)return;if(a.key==="ArrowUp"||a.key==="ArrowDown"||a.key==="ArrowLeft"||a.key==="ArrowRight")a.stopPropagation(),a.preventDefault();else return;const N=(navigator.platform.match("Mac")?a.metaKey:a.ctrlKey)?Ve.nudgeStepLarge:a.shiftKey?Ve.nudgeStepMedium:Ve.nudgeStep,I=We(n,C.width,C.height),_=En(I,a.key,N,s),D=Ks(_,d,s,C.width,C.height,u,h,c,l);if(!Xs(n,D)){const S=jt(D,C.width,C.height);f(D,S),g&&g(D,S)}}),de(this,"onDocPointerDone",a=>{const{crop:s,disabled:d,onComplete:n,onDragEnd:o}=this.props,u=this.getBox();this.unbindDocMove(),!(d||!s)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,o&&o(a),n&&n(We(s,u.width,u.height),jt(s,u.width,u.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),de(this,"onDragFocus",()=>{var a;(a=this.componentRef.current)==null||a.scrollTo(0,0)})}get document(){return document}getBox(){const a=this.mediaRef.current;if(!a)return{x:0,y:0,width:0,height:0};const{x:s,y:d,width:n,height:o}=a.getBoundingClientRect();return{x:s,y:d,width:n,height:o}}componentDidUpdate(a){const{crop:s,onComplete:d}=this.props;if(d&&!a.crop&&s){const{width:n,height:o}=this.getBox();n&&o&&d(We(s,n,o),jt(s,n,o))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,yt),this.document.addEventListener("pointerup",this.onDocPointerDone,yt),this.document.addEventListener("pointercancel",this.onDocPointerDone,yt),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,yt),this.document.removeEventListener("pointerup",this.onDocPointerDone,yt),this.document.removeEventListener("pointercancel",this.onDocPointerDone,yt),this.docMoveBound=!1)}getCropStyle(){const{crop:a}=this.props;if(a)return{top:`${a.y}${a.unit}`,left:`${a.x}${a.unit}`,width:`${a.width}${a.unit}`,height:`${a.height}${a.unit}`}}dragCrop(){const{evData:a}=this,s=this.getBox(),d=this.makePixelCrop(s),n=a.clientX-a.startClientX,o=a.clientY-a.startClientY;return d.x=bt(a.startCropX+n,0,s.width-d.width),d.y=bt(a.startCropY+o,0,s.height-d.height),d}getPointRegion(a,s,d,n){const{evData:o}=this,u=o.clientX-a.x,h=o.clientY-a.y;let c;n&&s?c=s==="nw"||s==="n"||s==="ne":c=h<o.startCropY;let l;return d&&s?l=s==="nw"||s==="w"||s==="sw":l=u<o.startCropX,l?c?"nw":"sw":c?"ne":"se"}resolveMinDimensions(a,s,d=0,n=0){const o=Math.min(d,a.width),u=Math.min(n,a.height);return!s||!o&&!u?[o,u]:s>1?o?[o,o/s]:[u*s,u]:u?[u*s,u]:[o,o/s]}resizeCrop(){const{evData:a}=this,{aspect:s=0,maxWidth:d,maxHeight:n}=this.props,o=this.getBox(),[u,h]=this.resolveMinDimensions(o,s,this.props.minWidth,this.props.minHeight);let c=this.makePixelCrop(o);const l=this.getPointRegion(o,a.ord,u,h),f=a.ord||l;let g=a.clientX-a.startClientX,C=a.clientY-a.startClientY;(u&&f==="nw"||f==="w"||f==="sw")&&(g=Math.min(g,-u)),(h&&f==="nw"||f==="n"||f==="ne")&&(C=Math.min(C,-h));const N={unit:"px",x:0,y:0,width:0,height:0};l==="ne"?(N.x=a.startCropX,N.width=g,s?(N.height=N.width/s,N.y=a.startCropY-N.height):(N.height=Math.abs(C),N.y=a.startCropY-N.height)):l==="se"?(N.x=a.startCropX,N.y=a.startCropY,N.width=g,s?N.height=N.width/s:N.height=C):l==="sw"?(N.x=a.startCropX+g,N.y=a.startCropY,N.width=Math.abs(g),s?N.height=N.width/s:N.height=C):l==="nw"&&(N.x=a.startCropX+g,N.width=Math.abs(g),s?(N.height=N.width/s,N.y=a.startCropY-N.height):(N.height=Math.abs(C),N.y=a.startCropY+C));const I=Ks(N,s,l,o.width,o.height,u,h,d,n);return s||Ve.xyOrds.indexOf(f)>-1?c=I:Ve.xOrds.indexOf(f)>-1?(c.x=I.x,c.width=I.width):Ve.yOrds.indexOf(f)>-1&&(c.y=I.y,c.height=I.height),c.x=bt(c.x,0,o.width-c.width),c.y=bt(c.y,0,o.height-c.height),c}renderCropSelection(){const{ariaLabels:a=Ve.defaultProps.ariaLabels,disabled:s,locked:d,renderSelectionAddon:n,ruleOfThirds:o,crop:u}=this.props,h=this.getCropStyle();if(u)return se.createElement("div",{style:h,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":a.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!s&&!d&&se.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},se.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),se.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),se.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),se.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),se.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":a.nwDragHandle,onKeyDown:c=>this.onHandlerKeyDown(c,"nw"),role:"button"}),se.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":a.nDragHandle,onKeyDown:c=>this.onHandlerKeyDown(c,"n"),role:"button"}),se.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":a.neDragHandle,onKeyDown:c=>this.onHandlerKeyDown(c,"ne"),role:"button"}),se.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":a.eDragHandle,onKeyDown:c=>this.onHandlerKeyDown(c,"e"),role:"button"}),se.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":a.seDragHandle,onKeyDown:c=>this.onHandlerKeyDown(c,"se"),role:"button"}),se.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":a.sDragHandle,onKeyDown:c=>this.onHandlerKeyDown(c,"s"),role:"button"}),se.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":a.swDragHandle,onKeyDown:c=>this.onHandlerKeyDown(c,"sw"),role:"button"}),se.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":a.wDragHandle,onKeyDown:c=>this.onHandlerKeyDown(c,"w"),role:"button"})),n&&se.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:c=>c.stopPropagation()},n(this.state)),o&&se.createElement(se.Fragment,null,se.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),se.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(a){const s={...Ut,...this.props.crop||{}};return We(s,a.width,a.height)}render(){const{aspect:a,children:s,circularCrop:d,className:n,crop:o,disabled:u,locked:h,style:c,ruleOfThirds:l}=this.props,{cropIsActive:f,newCropIsBeingDrawn:g}=this.state,C=o?this.renderCropSelection():null,N=Pn("ReactCrop",n,f&&"ReactCrop--active",u&&"ReactCrop--disabled",h&&"ReactCrop--locked",g&&"ReactCrop--new-crop",o&&a&&"ReactCrop--fixed-aspect",o&&d&&"ReactCrop--circular-crop",o&&l&&"ReactCrop--rule-of-thirds",!this.dragStarted&&o&&!o.width&&!o.height&&"ReactCrop--invisible-crop",d&&"ReactCrop--no-animate");return se.createElement("div",{ref:this.componentRef,className:N,style:c},se.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},s),o?se.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},se.createElement("defs",null,se.createElement("mask",{id:`hole-${this.instanceId}`},se.createElement("rect",{width:"100%",height:"100%",fill:"white"}),d?se.createElement("ellipse",{cx:`${o.x+o.width/2}${o.unit}`,cy:`${o.y+o.height/2}${o.unit}`,rx:`${o.width/2}${o.unit}`,ry:`${o.height/2}${o.unit}`,fill:"black"}):se.createElement("rect",{x:`${o.x}${o.unit}`,y:`${o.y}${o.unit}`,width:`${o.width}${o.unit}`,height:`${o.height}${o.unit}`,fill:"black"}))),se.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,C)}};de(Je,"xOrds",["e","w"]),de(Je,"yOrds",["n","s"]),de(Je,"xyOrds",["nw","ne","se","sw"]),de(Je,"nudgeStep",1),de(Je,"nudgeStepMedium",10),de(Je,"nudgeStepLarge",100),de(Je,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let At=Je;var kn=[" ","Enter","ArrowUp","ArrowDown"],Dn=[" ","Enter"],ht="Select",[qt,Xt,Tn]=Or(ht),[Nt,_o]=js(ht,[Tn,Ws]),Kt=Ws(),[An,st]=Nt(ht),[Rn,Mn]=Nt(ht),ca=t=>{const{__scopeSelect:a,children:s,open:d,defaultOpen:n,onOpenChange:o,value:u,defaultValue:h,onValueChange:c,dir:l,name:f,autoComplete:g,disabled:C,required:N,form:I}=t,_=Kt(a),[D,S]=r.useState(null),[A,R]=r.useState(null),[L,V]=r.useState(!1),Y=Zs(l),[q,Z]=Bt({prop:d,defaultProp:n??!1,onChange:o,caller:ht}),[ee,he]=Bt({prop:u,defaultProp:h,onChange:c,caller:ht}),ae=r.useRef(null),M=D?I||!!D.closest("form"):!0,[O,w]=r.useState(new Set),p=Array.from(O).map(x=>x.props.value).join(";");return e.jsx(Yr,{..._,children:e.jsxs(An,{required:N,scope:a,trigger:D,onTriggerChange:S,valueNode:A,onValueNodeChange:R,valueNodeHasChildren:L,onValueNodeHasChildrenChange:V,contentId:zt(),value:ee,onValueChange:he,open:q,onOpenChange:Z,dir:Y,triggerPointerDownPosRef:ae,disabled:C,children:[e.jsx(qt.Provider,{scope:a,children:e.jsx(Rn,{scope:t.__scopeSelect,onNativeOptionAdd:r.useCallback(x=>{w(y=>new Set(y).add(x))},[]),onNativeOptionRemove:r.useCallback(x=>{w(y=>{const m=new Set(y);return m.delete(x),m})},[]),children:s})}),M?e.jsxs(Aa,{"aria-hidden":!0,required:N,tabIndex:-1,name:f,autoComplete:g,value:ee,onChange:x=>he(x.target.value),disabled:C,form:I,children:[ee===void 0?e.jsx("option",{value:""}):null,Array.from(O)]},p):null]})})};ca.displayName=ht;var da="SelectTrigger",ua=r.forwardRef((t,a)=>{const{__scopeSelect:s,disabled:d=!1,...n}=t,o=Kt(s),u=st(da,s),h=u.disabled||d,c=Fe(a,u.onTriggerChange),l=Xt(s),f=r.useRef("touch"),[g,C,N]=Ma(_=>{const D=l().filter(R=>!R.disabled),S=D.find(R=>R.value===u.value),A=La(D,_,S);A!==void 0&&u.onValueChange(A.value)}),I=_=>{h||(u.onOpenChange(!0),N()),_&&(u.triggerPointerDownPosRef.current={x:Math.round(_.pageX),y:Math.round(_.pageY)})};return e.jsx(Br,{asChild:!0,...o,children:e.jsx(xe.button,{type:"button",role:"combobox","aria-controls":u.contentId,"aria-expanded":u.open,"aria-required":u.required,"aria-autocomplete":"none",dir:u.dir,"data-state":u.open?"open":"closed",disabled:h,"data-disabled":h?"":void 0,"data-placeholder":Ra(u.value)?"":void 0,...n,ref:c,onClick:pe(n.onClick,_=>{_.currentTarget.focus(),f.current!=="mouse"&&I(_)}),onPointerDown:pe(n.onPointerDown,_=>{f.current=_.pointerType;const D=_.target;D.hasPointerCapture(_.pointerId)&&D.releasePointerCapture(_.pointerId),_.button===0&&_.ctrlKey===!1&&_.pointerType==="mouse"&&(I(_),_.preventDefault())}),onKeyDown:pe(n.onKeyDown,_=>{const D=g.current!=="";!(_.ctrlKey||_.altKey||_.metaKey)&&_.key.length===1&&C(_.key),!(D&&_.key===" ")&&kn.includes(_.key)&&(I(),_.preventDefault())})})})});ua.displayName=da;var ha="SelectValue",ma=r.forwardRef((t,a)=>{const{__scopeSelect:s,className:d,style:n,children:o,placeholder:u="",...h}=t,c=st(ha,s),{onValueNodeHasChildrenChange:l}=c,f=o!==void 0,g=Fe(a,c.onValueNodeChange);return et(()=>{l(f)},[l,f]),e.jsx(xe.span,{...h,ref:g,style:{pointerEvents:"none"},children:Ra(c.value)?e.jsx(e.Fragment,{children:u}):o})});ma.displayName=ha;var Ln="SelectIcon",pa=r.forwardRef((t,a)=>{const{__scopeSelect:s,children:d,...n}=t;return e.jsx(xe.span,{"aria-hidden":!0,...n,ref:a,children:d||"â–¼"})});pa.displayName=Ln;var Fn="SelectPortal",ga=t=>e.jsx(Wr,{asChild:!0,...t});ga.displayName=Fn;var mt="SelectContent",xa=r.forwardRef((t,a)=>{const s=st(mt,t.__scopeSelect),[d,n]=r.useState();if(et(()=>{n(new DocumentFragment)},[]),!s.open){const o=d;return o?Js.createPortal(e.jsx(fa,{scope:t.__scopeSelect,children:e.jsx(qt.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),o):null}return e.jsx(wa,{...t,ref:a})});xa.displayName=mt;var ze=10,[fa,at]=Nt(mt),On="SelectContentImpl",Bn=Jr("SelectContent.RemoveScroll"),wa=r.forwardRef((t,a)=>{const{__scopeSelect:s,position:d="item-aligned",onCloseAutoFocus:n,onEscapeKeyDown:o,onPointerDownOutside:u,side:h,sideOffset:c,align:l,alignOffset:f,arrowPadding:g,collisionBoundary:C,collisionPadding:N,sticky:I,hideWhenDetached:_,avoidCollisions:D,...S}=t,A=st(mt,s),[R,L]=r.useState(null),[V,Y]=r.useState(null),q=Fe(a,F=>L(F)),[Z,ee]=r.useState(null),[he,ae]=r.useState(null),M=Xt(s),[O,w]=r.useState(!1),p=r.useRef(!1);r.useEffect(()=>{if(R)return $r(R)},[R]),Ur();const x=r.useCallback(F=>{const[z,...re]=M().map(J=>J.ref.current),[W]=re.slice(-1),Q=document.activeElement;for(const J of F)if(J===Q||(J==null||J.scrollIntoView({block:"nearest"}),J===z&&V&&(V.scrollTop=0),J===W&&V&&(V.scrollTop=V.scrollHeight),J==null||J.focus(),document.activeElement!==Q))return},[M,V]),y=r.useCallback(()=>x([Z,R]),[x,Z,R]);r.useEffect(()=>{O&&y()},[O,y]);const{onOpenChange:m,triggerPointerDownPosRef:E}=A;r.useEffect(()=>{if(R){let F={x:0,y:0};const z=W=>{var Q,J;F={x:Math.abs(Math.round(W.pageX)-(((Q=E.current)==null?void 0:Q.x)??0)),y:Math.abs(Math.round(W.pageY)-(((J=E.current)==null?void 0:J.y)??0))}},re=W=>{F.x<=10&&F.y<=10?W.preventDefault():R.contains(W.target)||m(!1),document.removeEventListener("pointermove",z),E.current=null};return E.current!==null&&(document.addEventListener("pointermove",z),document.addEventListener("pointerup",re,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",z),document.removeEventListener("pointerup",re,{capture:!0})}}},[R,m,E]),r.useEffect(()=>{const F=()=>m(!1);return window.addEventListener("blur",F),window.addEventListener("resize",F),()=>{window.removeEventListener("blur",F),window.removeEventListener("resize",F)}},[m]);const[$,H]=Ma(F=>{const z=M().filter(Q=>!Q.disabled),re=z.find(Q=>Q.ref.current===document.activeElement),W=La(z,F,re);W&&setTimeout(()=>W.ref.current.focus())}),oe=r.useCallback((F,z,re)=>{const W=!p.current&&!re;(A.value!==void 0&&A.value===z||W)&&(ee(F),W&&(p.current=!0))},[A.value]),me=r.useCallback(()=>R==null?void 0:R.focus(),[R]),ue=r.useCallback((F,z,re)=>{const W=!p.current&&!re;(A.value!==void 0&&A.value===z||W)&&ae(F)},[A.value]),Pe=d==="popper"?hs:va,ie=Pe===hs?{side:h,sideOffset:c,align:l,alignOffset:f,arrowPadding:g,collisionBoundary:C,collisionPadding:N,sticky:I,hideWhenDetached:_,avoidCollisions:D}:{};return e.jsx(fa,{scope:s,content:R,viewport:V,onViewportChange:Y,itemRefCallback:oe,selectedItem:Z,onItemLeave:me,itemTextRefCallback:ue,focusSelectedItem:y,selectedItemText:he,position:d,isPositioned:O,searchRef:$,children:e.jsx(Vr,{as:Bn,allowPinchZoom:!0,children:e.jsx(zr,{asChild:!0,trapped:A.open,onMountAutoFocus:F=>{F.preventDefault()},onUnmountAutoFocus:pe(n,F=>{var z;(z=A.trigger)==null||z.focus({preventScroll:!0}),F.preventDefault()}),children:e.jsx(Hr,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:u,onFocusOutside:F=>F.preventDefault(),onDismiss:()=>A.onOpenChange(!1),children:e.jsx(Pe,{role:"listbox",id:A.contentId,"data-state":A.open?"open":"closed",dir:A.dir,onContextMenu:F=>F.preventDefault(),...S,...ie,onPlaced:()=>w(!0),ref:q,style:{display:"flex",flexDirection:"column",outline:"none",...S.style},onKeyDown:pe(S.onKeyDown,F=>{const z=F.ctrlKey||F.altKey||F.metaKey;if(F.key==="Tab"&&F.preventDefault(),!z&&F.key.length===1&&H(F.key),["ArrowUp","ArrowDown","Home","End"].includes(F.key)){let W=M().filter(Q=>!Q.disabled).map(Q=>Q.ref.current);if(["ArrowUp","End"].includes(F.key)&&(W=W.slice().reverse()),["ArrowUp","ArrowDown"].includes(F.key)){const Q=F.target,J=W.indexOf(Q);W=W.slice(J+1)}setTimeout(()=>x(W)),F.preventDefault()}})})})})})})});wa.displayName=On;var $n="SelectItemAlignedPosition",va=r.forwardRef((t,a)=>{const{__scopeSelect:s,onPlaced:d,...n}=t,o=st(mt,s),u=at(mt,s),[h,c]=r.useState(null),[l,f]=r.useState(null),g=Fe(a,q=>f(q)),C=Xt(s),N=r.useRef(!1),I=r.useRef(!0),{viewport:_,selectedItem:D,selectedItemText:S,focusSelectedItem:A}=u,R=r.useCallback(()=>{if(o.trigger&&o.valueNode&&h&&l&&_&&D&&S){const q=o.trigger.getBoundingClientRect(),Z=l.getBoundingClientRect(),ee=o.valueNode.getBoundingClientRect(),he=S.getBoundingClientRect();if(o.dir!=="rtl"){const Q=he.left-Z.left,J=ee.left-Q,Oe=q.left-J,qe=q.width+Oe,pt=Math.max(qe,Z.width),gt=window.innerWidth-ze,rt=qs(J,[ze,Math.max(ze,gt-pt)]);h.style.minWidth=qe+"px",h.style.left=rt+"px"}else{const Q=Z.right-he.right,J=window.innerWidth-ee.right-Q,Oe=window.innerWidth-q.right-J,qe=q.width+Oe,pt=Math.max(qe,Z.width),gt=window.innerWidth-ze,rt=qs(J,[ze,Math.max(ze,gt-pt)]);h.style.minWidth=qe+"px",h.style.right=rt+"px"}const ae=C(),M=window.innerHeight-ze*2,O=_.scrollHeight,w=window.getComputedStyle(l),p=parseInt(w.borderTopWidth,10),x=parseInt(w.paddingTop,10),y=parseInt(w.borderBottomWidth,10),m=parseInt(w.paddingBottom,10),E=p+x+O+m+y,$=Math.min(D.offsetHeight*5,E),H=window.getComputedStyle(_),oe=parseInt(H.paddingTop,10),me=parseInt(H.paddingBottom,10),ue=q.top+q.height/2-ze,Pe=M-ue,ie=D.offsetHeight/2,F=D.offsetTop+ie,z=p+x+F,re=E-z;if(z<=ue){const Q=ae.length>0&&D===ae[ae.length-1].ref.current;h.style.bottom="0px";const J=l.clientHeight-_.offsetTop-_.offsetHeight,Oe=Math.max(Pe,ie+(Q?me:0)+J+y),qe=z+Oe;h.style.height=qe+"px"}else{const Q=ae.length>0&&D===ae[0].ref.current;h.style.top="0px";const Oe=Math.max(ue,p+_.offsetTop+(Q?oe:0)+ie)+re;h.style.height=Oe+"px",_.scrollTop=z-ue+_.offsetTop}h.style.margin=`${ze}px 0`,h.style.minHeight=$+"px",h.style.maxHeight=M+"px",d==null||d(),requestAnimationFrame(()=>N.current=!0)}},[C,o.trigger,o.valueNode,h,l,_,D,S,o.dir,d]);et(()=>R(),[R]);const[L,V]=r.useState();et(()=>{l&&V(window.getComputedStyle(l).zIndex)},[l]);const Y=r.useCallback(q=>{q&&I.current===!0&&(R(),A==null||A(),I.current=!1)},[R,A]);return e.jsx(Vn,{scope:s,contentWrapper:h,shouldExpandOnScrollRef:N,onScrollButtonChange:Y,children:e.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:L},children:e.jsx(xe.div,{...n,ref:g,style:{boxSizing:"border-box",maxHeight:"100%",...n.style}})})})});va.displayName=$n;var Un="SelectPopperPosition",hs=r.forwardRef((t,a)=>{const{__scopeSelect:s,align:d="start",collisionPadding:n=ze,...o}=t,u=Kt(s);return e.jsx(Gr,{...u,...o,ref:a,align:d,collisionPadding:n,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});hs.displayName=Un;var[Vn,Is]=Nt(mt,{}),ms="SelectViewport",ba=r.forwardRef((t,a)=>{const{__scopeSelect:s,nonce:d,...n}=t,o=at(ms,s),u=Is(ms,s),h=Fe(a,o.onViewportChange),c=r.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:d}),e.jsx(qt.Slot,{scope:s,children:e.jsx(xe.div,{"data-radix-select-viewport":"",role:"presentation",...n,ref:h,style:{position:"relative",flex:1,overflow:"hidden auto",...n.style},onScroll:pe(n.onScroll,l=>{const f=l.currentTarget,{contentWrapper:g,shouldExpandOnScrollRef:C}=u;if(C!=null&&C.current&&g){const N=Math.abs(c.current-f.scrollTop);if(N>0){const I=window.innerHeight-ze*2,_=parseFloat(g.style.minHeight),D=parseFloat(g.style.height),S=Math.max(_,D);if(S<I){const A=S+N,R=Math.min(I,A),L=A-R;g.style.height=R+"px",g.style.bottom==="0px"&&(f.scrollTop=L>0?L:0,g.style.justifyContent="flex-end")}}}c.current=f.scrollTop})})})]})});ba.displayName=ms;var ja="SelectGroup",[zn,Hn]=Nt(ja),Gn=r.forwardRef((t,a)=>{const{__scopeSelect:s,...d}=t,n=zt();return e.jsx(zn,{scope:s,id:n,children:e.jsx(xe.div,{role:"group","aria-labelledby":n,...d,ref:a})})});Gn.displayName=ja;var ya="SelectLabel",Na=r.forwardRef((t,a)=>{const{__scopeSelect:s,...d}=t,n=Hn(ya,s);return e.jsx(xe.div,{id:n.id,...d,ref:a})});Na.displayName=ya;var Vt="SelectItem",[qn,Ca]=Nt(Vt),Sa=r.forwardRef((t,a)=>{const{__scopeSelect:s,value:d,disabled:n=!1,textValue:o,...u}=t,h=st(Vt,s),c=at(Vt,s),l=h.value===d,[f,g]=r.useState(o??""),[C,N]=r.useState(!1),I=Fe(a,A=>{var R;return(R=c.itemRefCallback)==null?void 0:R.call(c,A,d,n)}),_=zt(),D=r.useRef("touch"),S=()=>{n||(h.onValueChange(d),h.onOpenChange(!1))};if(d==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(qn,{scope:s,value:d,disabled:n,textId:_,isSelected:l,onItemTextChange:r.useCallback(A=>{g(R=>R||((A==null?void 0:A.textContent)??"").trim())},[]),children:e.jsx(qt.ItemSlot,{scope:s,value:d,disabled:n,textValue:f,children:e.jsx(xe.div,{role:"option","aria-labelledby":_,"data-highlighted":C?"":void 0,"aria-selected":l&&C,"data-state":l?"checked":"unchecked","aria-disabled":n||void 0,"data-disabled":n?"":void 0,tabIndex:n?void 0:-1,...u,ref:I,onFocus:pe(u.onFocus,()=>N(!0)),onBlur:pe(u.onBlur,()=>N(!1)),onClick:pe(u.onClick,()=>{D.current!=="mouse"&&S()}),onPointerUp:pe(u.onPointerUp,()=>{D.current==="mouse"&&S()}),onPointerDown:pe(u.onPointerDown,A=>{D.current=A.pointerType}),onPointerMove:pe(u.onPointerMove,A=>{var R;D.current=A.pointerType,n?(R=c.onItemLeave)==null||R.call(c):D.current==="mouse"&&A.currentTarget.focus({preventScroll:!0})}),onPointerLeave:pe(u.onPointerLeave,A=>{var R;A.currentTarget===document.activeElement&&((R=c.onItemLeave)==null||R.call(c))}),onKeyDown:pe(u.onKeyDown,A=>{var L;((L=c.searchRef)==null?void 0:L.current)!==""&&A.key===" "||(Dn.includes(A.key)&&S(),A.key===" "&&A.preventDefault())})})})})});Sa.displayName=Vt;var kt="SelectItemText",_a=r.forwardRef((t,a)=>{const{__scopeSelect:s,className:d,style:n,...o}=t,u=st(kt,s),h=at(kt,s),c=Ca(kt,s),l=Mn(kt,s),[f,g]=r.useState(null),C=Fe(a,S=>g(S),c.onItemTextChange,S=>{var A;return(A=h.itemTextRefCallback)==null?void 0:A.call(h,S,c.value,c.disabled)}),N=f==null?void 0:f.textContent,I=r.useMemo(()=>e.jsx("option",{value:c.value,disabled:c.disabled,children:N},c.value),[c.disabled,c.value,N]),{onNativeOptionAdd:_,onNativeOptionRemove:D}=l;return et(()=>(_(I),()=>D(I)),[_,D,I]),e.jsxs(e.Fragment,{children:[e.jsx(xe.span,{id:c.textId,...o,ref:C}),c.isSelected&&u.valueNode&&!u.valueNodeHasChildren?Js.createPortal(o.children,u.valueNode):null]})});_a.displayName=kt;var Pa="SelectItemIndicator",Ea=r.forwardRef((t,a)=>{const{__scopeSelect:s,...d}=t;return Ca(Pa,s).isSelected?e.jsx(xe.span,{"aria-hidden":!0,...d,ref:a}):null});Ea.displayName=Pa;var ps="SelectScrollUpButton",Ia=r.forwardRef((t,a)=>{const s=at(ps,t.__scopeSelect),d=Is(ps,t.__scopeSelect),[n,o]=r.useState(!1),u=Fe(a,d.onScrollButtonChange);return et(()=>{if(s.viewport&&s.isPositioned){let h=function(){const l=c.scrollTop>0;o(l)};const c=s.viewport;return h(),c.addEventListener("scroll",h),()=>c.removeEventListener("scroll",h)}},[s.viewport,s.isPositioned]),n?e.jsx(Da,{...t,ref:u,onAutoScroll:()=>{const{viewport:h,selectedItem:c}=s;h&&c&&(h.scrollTop=h.scrollTop-c.offsetHeight)}}):null});Ia.displayName=ps;var gs="SelectScrollDownButton",ka=r.forwardRef((t,a)=>{const s=at(gs,t.__scopeSelect),d=Is(gs,t.__scopeSelect),[n,o]=r.useState(!1),u=Fe(a,d.onScrollButtonChange);return et(()=>{if(s.viewport&&s.isPositioned){let h=function(){const l=c.scrollHeight-c.clientHeight,f=Math.ceil(c.scrollTop)<l;o(f)};const c=s.viewport;return h(),c.addEventListener("scroll",h),()=>c.removeEventListener("scroll",h)}},[s.viewport,s.isPositioned]),n?e.jsx(Da,{...t,ref:u,onAutoScroll:()=>{const{viewport:h,selectedItem:c}=s;h&&c&&(h.scrollTop=h.scrollTop+c.offsetHeight)}}):null});ka.displayName=gs;var Da=r.forwardRef((t,a)=>{const{__scopeSelect:s,onAutoScroll:d,...n}=t,o=at("SelectScrollButton",s),u=r.useRef(null),h=Xt(s),c=r.useCallback(()=>{u.current!==null&&(window.clearInterval(u.current),u.current=null)},[]);return r.useEffect(()=>()=>c(),[c]),et(()=>{var f;const l=h().find(g=>g.ref.current===document.activeElement);(f=l==null?void 0:l.ref.current)==null||f.scrollIntoView({block:"nearest"})},[h]),e.jsx(xe.div,{"aria-hidden":!0,...n,ref:a,style:{flexShrink:0,...n.style},onPointerDown:pe(n.onPointerDown,()=>{u.current===null&&(u.current=window.setInterval(d,50))}),onPointerMove:pe(n.onPointerMove,()=>{var l;(l=o.onItemLeave)==null||l.call(o),u.current===null&&(u.current=window.setInterval(d,50))}),onPointerLeave:pe(n.onPointerLeave,()=>{c()})})}),Xn="SelectSeparator",Ta=r.forwardRef((t,a)=>{const{__scopeSelect:s,...d}=t;return e.jsx(xe.div,{"aria-hidden":!0,...d,ref:a})});Ta.displayName=Xn;var xs="SelectArrow",Kn=r.forwardRef((t,a)=>{const{__scopeSelect:s,...d}=t,n=Kt(s),o=st(xs,s),u=at(xs,s);return o.open&&u.position==="popper"?e.jsx(qr,{...n,...d,ref:a}):null});Kn.displayName=xs;var Yn="SelectBubbleInput",Aa=r.forwardRef(({__scopeSelect:t,value:a,...s},d)=>{const n=r.useRef(null),o=Fe(d,n),u=ea(a);return r.useEffect(()=>{const h=n.current;if(!h)return;const c=window.HTMLSelectElement.prototype,f=Object.getOwnPropertyDescriptor(c,"value").set;if(u!==a&&f){const g=new Event("change",{bubbles:!0});f.call(h,a),h.dispatchEvent(g)}},[u,a]),e.jsx(xe.select,{...s,style:{...Xr,...s.style},ref:o,defaultValue:a})});Aa.displayName=Yn;function Ra(t){return t===""||t===void 0}function Ma(t){const a=Kr(t),s=r.useRef(""),d=r.useRef(0),n=r.useCallback(u=>{const h=s.current+u;a(h),function c(l){s.current=l,window.clearTimeout(d.current),l!==""&&(d.current=window.setTimeout(()=>c(""),1e3))}(h)},[a]),o=r.useCallback(()=>{s.current="",window.clearTimeout(d.current)},[]);return r.useEffect(()=>()=>window.clearTimeout(d.current),[]),[s,n,o]}function La(t,a,s){const n=a.length>1&&Array.from(a).every(l=>l===a[0])?a[0]:a,o=s?t.indexOf(s):-1;let u=Wn(t,Math.max(o,0));n.length===1&&(u=u.filter(l=>l!==s));const c=u.find(l=>l.textValue.toLowerCase().startsWith(n.toLowerCase()));return c!==s?c:void 0}function Wn(t,a){return t.map((s,d)=>t[(a+d)%t.length])}var Jn=ca,Fa=ua,Zn=ma,Qn=pa,eo=ga,Oa=xa,to=ba,Ba=Na,$a=Sa,so=_a,ao=Ea,Ua=Ia,Va=ka,za=Ta;const it=Jn,lt=Zn,Ze=r.forwardRef(({className:t,children:a,...s},d)=>e.jsxs(Fa,{ref:d,className:Te("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...s,children:[a,e.jsx(Qn,{asChild:!0,children:e.jsx(Ss,{className:"h-4 w-4 opacity-50"})})]}));Ze.displayName=Fa.displayName;const Ha=r.forwardRef(({className:t,...a},s)=>e.jsx(Ua,{ref:s,className:Te("flex cursor-default items-center justify-center py-1",t),...a,children:e.jsx(vn,{className:"h-4 w-4"})}));Ha.displayName=Ua.displayName;const Ga=r.forwardRef(({className:t,...a},s)=>e.jsx(Va,{ref:s,className:Te("flex cursor-default items-center justify-center py-1",t),...a,children:e.jsx(Ss,{className:"h-4 w-4"})}));Ga.displayName=Va.displayName;const Qe=r.forwardRef(({className:t,children:a,position:s="popper",...d},n)=>e.jsx(eo,{children:e.jsxs(Oa,{ref:n,className:Te("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...d,children:[e.jsx(Ha,{}),e.jsx(to,{className:Te("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(Ga,{})]})}));Qe.displayName=Oa.displayName;const ro=r.forwardRef(({className:t,...a},s)=>e.jsx(Ba,{ref:s,className:Te("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...a}));ro.displayName=Ba.displayName;const le=r.forwardRef(({className:t,children:a,...s},d)=>e.jsxs($a,{ref:d,className:Te("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ao,{children:e.jsx(Zr,{className:"h-4 w-4"})})}),e.jsx(so,{children:a})]}));le.displayName=$a.displayName;const fs=r.forwardRef(({className:t,...a},s)=>e.jsx(za,{ref:s,className:Te("-mx-1 my-1 h-px bg-muted",t),...a}));fs.displayName=za.displayName;const no=()=>{const{t}=tt(),[a,s]=r.useState([]),[d,n]=r.useState(!1),[o,u]=r.useState(null),[h,c]=r.useState({name:"",phone:"",subject:"",telegram:""}),[l,f]=r.useState(null),[g,C]=r.useState(""),[N,I]=r.useState(""),[_,D]=r.useState(),[S,A]=r.useState(),[R,L]=r.useState(""),[V,Y]=r.useState(""),q=r.useRef(null);Ht(()=>R?(L(""),!0):d?(n(!1),!0):!1),r.useEffect(()=>{Z(),ee()},[]);const Z=async()=>{try{const m=await Ee.getTeachers(),E=Array.isArray(m)?m.sort(($,H)=>$.name.localeCompare(H.name)):[];s(E)}catch(m){console.error("Failed to fetch teachers:",m),v.error("Failed to load teachers")}},ee=async()=>{I("[School Phone]")},he=m=>{var $;const E=($=m.target.files)==null?void 0:$[0];if(E){const H=new FileReader;H.onloadend=()=>{L(H.result)},H.readAsDataURL(E)}},ae=async()=>{if(!S||!q.current)return null;const m=q.current,E=document.createElement("canvas"),$=E.getContext("2d");if(!$)return null;const H=m.naturalWidth/m.width,oe=m.naturalHeight/m.height;return E.width=S.width,E.height=S.height,$.drawImage(m,S.x*H,S.y*oe,S.width*H,S.height*oe,0,0,S.width,S.height),new Promise(me=>{E.toBlob(ue=>{me(ue)},"image/jpeg",.95)})},M=async()=>{const m=await ae();if(m){const E=new File([m],"cropped-image.jpg",{type:"image/jpeg"});f(E),C(URL.createObjectURL(m)),L(""),v.success("Image cropped successfully")}},O=async m=>{if(!l)return null;try{const E=await Ee.uploadFile(l);return(E==null?void 0:E.url)||null}catch(E){return console.error("Upload error:",E),v.error("Failed to upload photo"),null}},w=async m=>{if(m.preventDefault(),!h.name||!h.phone||!h.subject){v.error("Please fill in all required fields");return}try{let E=(o==null?void 0:o.photo_url)||null;if(l){const H=(o==null?void 0:o.id)||`temp-${Date.now()}`;E=await O(H)}const $={name:h.name,phone:h.phone,subject:h.subject,telegram:h.telegram||null};E&&($.photo_url=E),o?(await Ee.upsertTeacher({id:o.id,...$}),v.success("Teacher updated successfully!")):(await Ee.upsertTeacher($),v.success("Teacher added successfully!")),n(!1),u(null),c({name:"",phone:"",subject:"",telegram:""}),f(null),C(""),L(""),Z()}catch(E){console.error("Error:",E),v.error("Failed to save teacher")}},p=m=>{u(m),c({name:m.name,phone:m.phone,subject:m.subject,telegram:m.telegram||""}),C(m.photo_url||""),n(!0)},x=async(m,E)=>{if(window.confirm(`Are you sure you want to delete ${E}?`))try{await Ee.deleteTeacher(m),v.success("Teacher deleted"),Z()}catch($){console.error("Failed to delete teacher",$),v.error("Failed to delete teacher")}},y=()=>{u(null),c({name:"",phone:"",subject:"",telegram:""}),f(null),C(""),L(""),n(!0)};return e.jsxs(Ie,{className:"p-4 sm:p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-primary",children:t("teacherManagementTitle")}),e.jsxs(P,{onClick:y,className:"bg-admin hover:bg-admin/90 gap-2",children:[e.jsx(ut,{className:"w-4 h-4"}),t("addTeacherButton")]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.map(m=>e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow bg-white",children:e.jsxs("div",{className:"flex items-start gap-3",children:[m.photo_url?e.jsx("img",{src:m.photo_url,alt:m.name,onClick:()=>Y(m.photo_url||""),className:"w-16 h-16 rounded-full object-cover border-2 border-admin cursor-pointer"}):e.jsxs("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center border-2 border-admin relative",children:[e.jsx("span",{className:"absolute inset-0 rounded-full animate-ping bg-admin/20"}),e.jsx(ct,{className:"w-8 h-8 text-muted-foreground"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:m.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.subject}),e.jsxs("p",{className:"text-sm",children:["ðŸ“ž ",m.phone]}),m.telegram&&e.jsxs("p",{className:"text-sm",children:["ðŸ“± @",m.telegram]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>p(m),className:"text-admin hover:text-admin hover:bg-admin/10 cursor-pointer",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>x(m.id,m.name),className:"text-destructive hover:text-destructive hover:bg-destructive/10 cursor-pointer",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})},m.id))}),a.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:t("noTeacherInfo")}),e.jsx(we,{open:d,onOpenChange:n,children:e.jsxs(ve,{className:"max-w-md",children:[e.jsx(Se,{children:e.jsx(_e,{children:t(o?"editTeacherTitle":"addTeacherButton")})}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[g?e.jsx("img",{src:g,alt:"Preview",className:"w-24 h-24 rounded-full object-cover border-4 border-admin"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-muted flex items-center justify-center border-4 border-admin",children:e.jsx(ct,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("label",{className:"cursor-pointer flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-admin hover:underline",children:[e.jsx(Ps,{className:"w-4 h-4"}),t("uploadPhoto")]}),e.jsx("input",{type:"file",accept:"image/*",onChange:he,className:"hidden"})]})]}),e.jsx(G,{placeholder:t("teacherNamePlaceholder"),value:h.name,onChange:m=>c({...h,name:m.target.value}),required:!0}),e.jsx(G,{placeholder:t("teacherPhonePlaceholder"),value:h.phone,onChange:m=>c({...h,phone:m.target.value}),required:!0}),e.jsx(G,{placeholder:t("teacherSubjectPlaceholder"),value:h.subject,onChange:m=>c({...h,subject:m.target.value}),required:!0}),e.jsx(G,{placeholder:t("teacherTelegramPlaceholder"),value:h.telegram,onChange:m=>c({...h,telegram:m.target.value})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(P,{type:"button",variant:"outline",onClick:()=>n(!1),children:t("cancel")}),e.jsx(P,{type:"submit",className:"bg-admin hover:bg-admin/90",children:t(o?"updateLabel":"addTeacherButton")})]})]})]})}),V&&e.jsx(we,{open:!!V,onOpenChange:()=>Y(""),children:e.jsx(ve,{className:"max-w-sm",children:e.jsx("div",{className:"flex items-center justify-center p-6 bg-blue-600 rounded-lg",children:e.jsx("img",{src:V,alt:"Preview",className:"w-48 h-48 rounded-full object-cover border-4 border-white"})})})}),R&&e.jsx(we,{open:!!R,onOpenChange:()=>L(""),children:e.jsxs(ve,{className:"max-w-2xl",children:[e.jsx(Se,{children:e.jsx(_e,{children:t("cropImage")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(At,{crop:_,onChange:m=>D(m),onComplete:m=>A(m),aspect:1,circularCrop:!0,children:e.jsx("img",{ref:q,src:R,alt:"Crop",className:"max-h-96 mx-auto"})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(P,{variant:"outline",onClick:()=>L(""),children:t("cancel")}),e.jsx(P,{onClick:M,className:"bg-admin hover:bg-admin/90",children:t("applyCrop")})]})]})]})})]})},oo=()=>{const{t}=tt(),[a,s]=r.useState([]),[d,n]=r.useState(!1),[o,u]=r.useState(null),[h,c]=r.useState(""),[l,f]=r.useState(""),[g,C]=r.useState(null),[N,I]=r.useState(""),[_,D]=r.useState(),[S,A]=r.useState(),R=r.useRef(null),[L,V]=r.useState(!1);Ht(()=>d?(n(!1),!0):!1),r.useEffect(()=>{Y()},[]);const Y=async()=>{try{const x=await Ee.listNews();s(Array.isArray(x)?x:[])}catch(x){console.error("Failed to fetch news",x),v.error("Failed to load news")}},q=async x=>new Promise((y,m)=>{const E=new FileReader;E.readAsDataURL(x),E.onload=$=>{var oe;const H=new Image;H.src=(oe=$.target)==null?void 0:oe.result,H.onload=()=>{const me=document.createElement("canvas"),ue=me.getContext("2d");if(!ue){y(x);return}const Pe=1200,ie=1200;let F=H.width,z=H.height;F>z?F>Pe&&(z*=Pe/F,F=Pe):z>ie&&(F*=ie/z,z=ie),me.width=F,me.height=z,ue.drawImage(H,0,0,F,z),me.toBlob(re=>{if(re){const W=x.name.replace(/\.[^/.]+$/,"")+".jpg",Q=new File([re],W,{type:"image/jpeg",lastModified:Date.now()});y(Q)}else y(x)},"image/jpeg",.7)},H.onerror=me=>m(me)},E.onerror=$=>m($)}),Z=x=>{var m;const y=(m=x.target.files)==null?void 0:m[0];if(y){C(y);const E=new FileReader;E.onloadend=()=>{I(E.result)},E.readAsDataURL(y)}},ee=async()=>{if(!S||!R.current)return null;const x=R.current,y=document.createElement("canvas"),m=y.getContext("2d");if(!m)return null;const E=x.naturalWidth/x.width,$=x.naturalHeight/x.height;return y.width=S.width,y.height=S.height,m.drawImage(x,S.x*E,S.y*$,S.width*E,S.height*$,0,0,S.width,S.height),new Promise(H=>{y.toBlob(oe=>{H(oe)},"image/jpeg",.95)})},he=async()=>{const x=await ee();if(x){const y=new File([x],"cropped-news.jpg",{type:"image/jpeg"});C(y),I(URL.createObjectURL(x)),D(void 0),A(void 0),v.success("Image cropped successfully")}},ae=async x=>{if(x.preventDefault(),!h.trim()||!l.trim()){v.error("Please fill in all fields");return}V(!0);try{let y=o==null?void 0:o.image_url;if(g){const E=await q(g),{url:$}=await Ee.uploadFile(E,"news-images");y=$}const m={title:h,content:l,image_url:y};if(o)await Ee.postNews({id:o.id,...m}),v.success("News updated successfully!");else{await Ee.postNews(m),ds(),v.success("News published!");try{const E=await Ee.notifyNews({title:h,content:l});E&&E.success!==void 0&&v.success(`Push sent to ${E.success} devices`)}catch(E){console.error("Failed to send push notifications",E),v.warning("News published, but failed to send notifications")}}n(!1),u(null),c(""),f(""),C(null),I(""),Y()}catch(y){console.error("Error:",y),v.error(`Failed to save news: ${y.message||"Unknown error"}`)}finally{V(!1)}},M=async x=>{if(window.confirm(`Send push notification again for "${x.title}"?`))try{ds(),v.info("Sending notifications...");const y=await Ee.notifyNews({title:x.title,content:x.content});y&&y.success!==void 0?v.success(`Push sent to ${y.success} devices`):y&&y.message?v.info(`Push info: ${y.message}`):v.success("Push notifications sent")}catch(y){console.error("Failed to send push notifications",y),v.error(`Failed to trigger push: ${y.message||"Unknown error"}`)}},O=x=>{u(x),c(x.title),f(x.content),I(x.image_url||""),C(null),n(!0)},w=async(x,y)=>{if(window.confirm(`Are you sure you want to delete "${y}"?`))try{await Ee.deleteNews(x),v.success("News deleted"),Y()}catch(m){console.error("Delete failed",m),v.error("Failed to delete news")}},p=()=>{u(null),c(""),f(""),I(""),C(null),n(!0)};return e.jsxs(Ie,{className:"p-4 sm:p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-primary",children:t("newsManagementTitle")}),e.jsxs(P,{onClick:p,className:"bg-primary hover:bg-primary/90 gap-2",children:[e.jsx(Vs,{className:"w-4 h-4"}),t("addNewsButton")]})]}),e.jsxs("div",{className:"space-y-3",children:[a.map(x=>e.jsx("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow relative overflow-hidden",style:{animation:"slowZoom 5.5s ease-in-out infinite"},children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-3 h-3 flex-shrink-0",children:[e.jsx("span",{className:"absolute inline-flex h-3 w-3 rounded-full bg-admin"}),e.jsx("span",{className:"absolute inline-flex h-6 w-6 rounded-full bg-admin/30 -z-10 transform translate-x-0 translate-y-0 animate-ping"})]}),e.jsx("h3",{className:"font-semibold text-lg mb-1",children:x.title})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2 whitespace-pre-wrap",children:x.content}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(x.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-3 border-t mt-2",children:[e.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>M(x),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 h-8",title:"Re-notify",children:[e.jsx(Vs,{className:"w-4 h-4 mr-1"}),t("publishNotifyButton")]}),e.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>O(x),className:"text-admin hover:text-admin hover:bg-admin/10 h-8",children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),t("edit")]}),e.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>w(x.id,x.title),className:"text-destructive hover:text-destructive hover:bg-destructive/10 h-8",children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),t("delete")]})]})]})},x.id)),e.jsx("style",{children:"@keyframes slowZoom {0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}"})]}),a.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:t("noNewsMessage")}),e.jsx(we,{open:d,onOpenChange:n,children:e.jsxs(ve,{className:"max-w-md",children:[e.jsx(Se,{children:e.jsx(_e,{children:t(o?"editNewsTitle":"addNewsButton")})}),e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(G,{placeholder:t("newsTitlePlaceholder"),value:h,onChange:x=>c(x.target.value),required:!0})}),e.jsx("div",{className:"space-y-2",children:e.jsx($t,{placeholder:t("newsContentPlaceholder"),value:l,onChange:x=>f(x.target.value),className:"min-h-[120px]",required:!0})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:t("newsImageLabel")}),e.jsx(G,{type:"file",accept:"image/*",onChange:Z,className:"cursor-pointer"})]}),N&&e.jsxs("div",{className:"space-y-4 border rounded-lg p-2 bg-gray-50",children:[e.jsx("div",{className:"relative w-full rounded-lg overflow-hidden",children:e.jsx(At,{crop:_,onChange:(x,y)=>D(y),onComplete:x=>A(x),aspect:void 0,className:"max-h-[40vh]",children:e.jsx("img",{ref:R,src:N,alt:"Preview",className:"max-h-[40vh] w-auto mx-auto object-contain",crossOrigin:"anonymous"})})}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(P,{type:"button",variant:"secondary",size:"sm",onClick:he,disabled:!(S!=null&&S.width)||!(S!=null&&S.height),className:"gap-2",children:[e.jsx(ta,{className:"w-4 h-4"}),t("cropSelection")]}),e.jsx(P,{type:"button",variant:"ghost",size:"sm",onClick:()=>{I(""),C(null)},className:"text-destructive",children:e.jsx(dt,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-2",children:[e.jsx(P,{type:"button",variant:"outline",onClick:()=>n(!1),children:t("cancel")}),e.jsx(P,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:L,children:t(L?"processing":o?"save":"publishNotifyButton")})]})]})]})})]})};var Yt="Tabs",[io,Po]=js(Yt,[Qs]),qa=Qs(),[lo,ks]=io(Yt),Xa=r.forwardRef((t,a)=>{const{__scopeTabs:s,value:d,onValueChange:n,defaultValue:o,orientation:u="horizontal",dir:h,activationMode:c="automatic",...l}=t,f=Zs(h),[g,C]=Bt({prop:d,onChange:n,defaultProp:o??"",caller:Yt});return e.jsx(lo,{scope:s,baseId:zt(),value:g,onValueChange:C,orientation:u,dir:f,activationMode:c,children:e.jsx(xe.div,{dir:f,"data-orientation":u,...l,ref:a})})});Xa.displayName=Yt;var Ka="TabsList",Ya=r.forwardRef((t,a)=>{const{__scopeTabs:s,loop:d=!0,...n}=t,o=ks(Ka,s),u=qa(s);return e.jsx(Qr,{asChild:!0,...u,orientation:o.orientation,dir:o.dir,loop:d,children:e.jsx(xe.div,{role:"tablist","aria-orientation":o.orientation,...n,ref:a})})});Ya.displayName=Ka;var Wa="TabsTrigger",Ja=r.forwardRef((t,a)=>{const{__scopeTabs:s,value:d,disabled:n=!1,...o}=t,u=ks(Wa,s),h=qa(s),c=er(u.baseId,d),l=tr(u.baseId,d),f=d===u.value;return e.jsx(en,{asChild:!0,...h,focusable:!n,active:f,children:e.jsx(xe.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":l,"data-state":f?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:c,...o,ref:a,onMouseDown:pe(t.onMouseDown,g=>{!n&&g.button===0&&g.ctrlKey===!1?u.onValueChange(d):g.preventDefault()}),onKeyDown:pe(t.onKeyDown,g=>{[" ","Enter"].includes(g.key)&&u.onValueChange(d)}),onFocus:pe(t.onFocus,()=>{const g=u.activationMode!=="manual";!f&&!n&&g&&u.onValueChange(d)})})})});Ja.displayName=Wa;var Za="TabsContent",Qa=r.forwardRef((t,a)=>{const{__scopeTabs:s,value:d,forceMount:n,children:o,...u}=t,h=ks(Za,s),c=er(h.baseId,d),l=tr(h.baseId,d),f=d===h.value,g=r.useRef(f);return r.useEffect(()=>{const C=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(C)},[]),e.jsx(tn,{present:n||f,children:({present:C})=>e.jsx(xe.div,{"data-state":f?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":c,hidden:!C,id:l,tabIndex:0,...u,ref:a,style:{...t.style,animationDuration:g.current?"0s":void 0},children:C&&o})})});Qa.displayName=Za;function er(t,a){return`${t}-trigger-${a}`}function tr(t,a){return`${t}-content-${a}`}var co=Xa,sr=Ya,ar=Ja,rr=Qa;const nr=co,Ds=r.forwardRef(({className:t,...a},s)=>e.jsx(sr,{ref:s,className:Te("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...a}));Ds.displayName=sr.displayName;const Dt=r.forwardRef(({className:t,...a},s)=>e.jsx(ar,{ref:s,className:Te("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...a}));Dt.displayName=ar.displayName;const ws=r.forwardRef(({className:t,...a},s)=>e.jsx(rr,{ref:s,className:Te("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a}));ws.displayName=rr.displayName;const uo=()=>{const{t}=tt(),[a,s]=r.useState([]),[d,n]=r.useState(!0),[o,u]=r.useState(!1),[h,c]=r.useState(null),[l,f]=r.useState("Cinematography"),[g,C]=r.useState({title:"",url:"",thumbnail_url:"",course_category:"Cinematography",sub_category:"",is_visible:!0,order_index:0,description:""}),[N,I]=r.useState([]),[_,D]=r.useState(!1),[S,A]=r.useState(null);r.useEffect(()=>{L()},[]),r.useEffect(()=>{const w=Array.from(new Set(a.filter(p=>p.course_category===l).map(p=>p.sub_category).filter(Boolean)));l==="Editing"&&(w.includes("Premiere Pro")||w.push("Premiere Pro"),w.includes("Photoshop")||w.push("Photoshop")),I(w)},[a,l]),r.useEffect(()=>{if(o){const w={modal:"videoManagement"};window.history.pushState(w,"",window.location.href);const p=()=>{u(!1)};return window.addEventListener("popstate",p),()=>{window.removeEventListener("popstate",p)}}},[o]);const R=()=>{var w;((w=window.history.state)==null?void 0:w.modal)==="videoManagement"?window.history.back():u(!1)},L=async()=>{try{const{data:w,error:p}=await k.from("videos").select("*").order("order_index",{ascending:!0});if(p)throw p;s(w||[])}catch(w){console.error("Error fetching videos:",w),v.error("Failed to load videos")}finally{n(!1)}},V=async()=>{try{if(h){const{error:w}=await k.from("videos").update(g).eq("id",h.id);if(w)throw w;v.success("Video updated successfully")}else{const{error:w}=await k.from("videos").insert([g]);if(w)throw w;v.success("Video added successfully")}R(),c(null),he(),L()}catch(w){console.error("Error saving video:",w),v.error(`Failed to save video: ${w.message||"Unknown error"}`)}},Y=async w=>{if(confirm("Are you sure you want to delete this video?"))try{const{error:p}=await k.from("videos").delete().eq("id",w);if(p)throw p;v.success("Video deleted successfully"),L()}catch(p){console.error("Error deleting video:",p),v.error("Failed to delete video")}},q=async w=>{try{const{error:p}=await k.from("videos").update({is_visible:!w.is_visible}).eq("id",w.id);if(p)throw p;L()}catch(p){console.error("Error updating visibility:",p),v.error("Failed to update visibility")}},Z=async w=>{if(confirm(`Are you sure you want to delete category "${w}"? This will delete ALL videos in this category!`))try{const{error:p}=await k.from("videos").delete().eq("course_category",l).eq("sub_category",w);if(p)throw p;v.success(`Category "${w}" and its videos deleted`),L()}catch(p){console.error("Error deleting category:",p),v.error(`Failed to delete category: ${p.message}`)}},ee=async()=>{if(!(!S||!S.new.trim()))try{const{error:w}=await k.from("videos").update({sub_category:S.new}).eq("course_category",l).eq("sub_category",S.old);if(w)throw w;v.success("Category updated"),A(null),L()}catch(w){console.error("Error updating category:",w),v.error(`Failed to update category: ${w.message}`)}},he=()=>{C({title:"",url:"",thumbnail_url:"",course_category:l,sub_category:"",is_visible:!0,order_index:a.length,description:""})},ae=w=>{c(w),C({title:w.title,url:w.url,thumbnail_url:w.thumbnail_url||"",course_category:w.course_category,sub_category:w.sub_category||"",is_visible:w.is_visible,order_index:w.order_index,description:w.description||""}),u(!0)},M=()=>{c(null),he(),u(!0)},O=({category:w})=>{const p=a.filter(x=>x.course_category===w);return e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[p.map(x=>e.jsxs("div",{className:"flex flex-col justify-between p-2 sm:p-4 bg-white border rounded-lg shadow-sm gap-2 h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 overflow-hidden w-full",children:[e.jsx("div",{className:"w-full sm:w-24 h-24 sm:h-16 bg-gray-100 rounded overflow-hidden flex-shrink-0",children:e.jsx("img",{src:x.thumbnail_url||sn(x.url)||"https://placehold.co/160x90?text=No+Image",alt:x.title,className:"w-full h-full object-cover",onError:y=>{y.target.src="https://placehold.co/160x90?text=No+Image"}})}),e.jsxs("div",{className:"min-w-0 flex-1 w-full",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base line-clamp-2 break-words",children:x.title}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 truncate w-full",children:x.url}),e.jsxs("div",{className:"flex items-center mt-1 space-x-2 flex-wrap gap-y-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x.is_visible?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:x.is_visible?t("active"):t("closed")}),e.jsxs("span",{className:"text-xs text-gray-400 whitespace-nowrap",children:[t("orderIndexLabel"),": ",x.order_index]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 pt-2 border-t mt-auto w-full",children:[e.jsxs(P,{variant:"ghost",size:"sm",className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 h-8 px-2",onClick:()=>q(x),children:[x.is_visible?e.jsx(Le,{className:"h-4 w-4"}):e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:x.is_visible?t("active"):t("closed")})]}),e.jsxs(P,{variant:"ghost",size:"sm",className:"text-admin hover:text-admin hover:bg-admin/10 h-8 px-2",onClick:()=>ae(x),children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:t("edit")})]}),e.jsxs(P,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10 h-8 px-2",onClick:()=>Y(x.id),children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:t("delete")})]})]})]},x.id)),p.length===0&&e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:t("noVideosInCategory")})]})};return e.jsxs(Ie,{className:"w-full shadow-lg",children:[e.jsxs(ys,{className:"flex flex-col gap-4",children:[e.jsx(Ns,{className:"text-primary",children:t("videoManagement")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",onClick:()=>D(!0),children:"Manage Categories"}),e.jsxs(P,{onClick:M,className:"bg-primary hover:bg-primary/90",children:[e.jsx(ut,{className:"mr-2 h-4 w-4"})," ",t("addVideo")]})]})]}),e.jsx(Cs,{children:e.jsxs(nr,{value:l,onValueChange:w=>f(w),children:[e.jsxs(Ds,{className:"mb-4 grid w-full grid-cols-2",children:[e.jsx(Dt,{value:"Cinematography",className:"data-[state=active]:bg-primary data-[state=active]:text-white data-[state=inactive]:bg-white data-[state=inactive]:text-primary border border-primary",children:t("cinematography")}),e.jsx(Dt,{value:"Editing",className:"data-[state=active]:bg-primary data-[state=active]:text-white data-[state=inactive]:bg-white data-[state=inactive]:text-primary border border-primary",children:t("videoEditing")})]}),e.jsx(ws,{value:"Cinematography",children:e.jsx(O,{category:"Cinematography"})}),e.jsx(ws,{value:"Editing",children:e.jsx(O,{category:"Editing"})})]})}),e.jsx(we,{open:o,onOpenChange:w=>{w?u(!0):R()},children:e.jsxs(ve,{children:[e.jsx(Se,{children:e.jsx(_e,{children:t(h?"editVideo":"addVideo")})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:t("title")}),e.jsx(G,{value:g.title,onChange:w=>C({...g,title:w.target.value}),placeholder:"Video Title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:t("videoUrl")}),e.jsx(G,{value:g.url,onChange:w=>C({...g,url:w.target.value}),placeholder:"YouTube URL"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"Description (Optional)"}),e.jsx($t,{value:g.description,onChange:w=>C({...g,description:w.target.value}),placeholder:"Video Description",className:"h-24"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"Sub Category"}),e.jsxs(it,{value:g.sub_category,onValueChange:w=>C({...g,sub_category:w}),children:[e.jsx(Ze,{children:e.jsx(lt,{placeholder:"Select or add new"})}),e.jsxs(Qe,{children:[N.map(w=>e.jsx(le,{value:w,children:w},w)),e.jsx(le,{value:"new",children:"+ Add New Category"})]})]})]}),g.sub_category==="new"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"New Category Name"}),e.jsx(G,{value:g.sub_category==="new"?"":g.sub_category,onChange:w=>C({...g,sub_category:w.target.value}),placeholder:"Enter new category name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:t("orderIndexLabel")}),e.jsx(G,{type:"number",value:g.order_index,onChange:w=>C({...g,order_index:parseInt(w.target.value)||0})})]}),e.jsx(P,{onClick:V,className:"w-full",children:t("save")})]})]})}),e.jsx(we,{open:_,onOpenChange:D,children:e.jsxs(ve,{children:[e.jsx(Se,{children:e.jsxs(_e,{children:["Manage Categories (",l==="Editing"?t("videoEditing"):l,")"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[N.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No custom categories found."}):e.jsx("div",{className:"space-y-2",children:N.map(w=>e.jsx("div",{className:"flex items-center justify-between p-2 border rounded bg-gray-50",children:(S==null?void 0:S.old)===w?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(G,{value:S.new,onChange:p=>A({...S,new:p.target.value})}),e.jsx(P,{size:"sm",onClick:ee,children:e.jsx(_s,{className:"w-4 h-4"})}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>A(null),children:e.jsx(dt,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:w}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>A({old:w,new:w}),children:e.jsx(Me,{className:"w-4 h-4 text-blue-600"})}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>Z(w),children:e.jsx(Xe,{className:"w-4 h-4 text-red-600"})})]})]})},w))}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:'To add a new category, use the "Add Video" button and select "Add New Category".'}),e.jsx(P,{className:"w-full",variant:"outline",onClick:()=>D(!1),children:"Close"})]})]})]})})]})},ho=()=>{const{t}=tt(),[a,s]=r.useState([]),[d,n]=r.useState(!0),[o,u]=r.useState(!1),[h,c]=r.useState(null),[l,f]=r.useState("Cinematography"),[g,C]=r.useState({title:"",course_category:"Cinematography",sub_category:"None",new_sub_category:"",cover_title:"",is_visible:!0,order_index:0}),[N,I]=r.useState(null),[_,D]=r.useState(!1),[S,A]=r.useState([]),[R,L]=r.useState(!1),[V,Y]=r.useState(null);r.useEffect(()=>{Z()},[]),r.useEffect(()=>{const p=Array.from(new Set(a.filter(x=>x.course_category===l).map(x=>x.sub_category).filter(Boolean).filter(x=>x!=="None")));A(p)},[a,l]),r.useEffect(()=>{if(o){const p={modal:"moduleManagement"};window.history.pushState(p,"",window.location.href);const x=()=>{u(!1)};return window.addEventListener("popstate",x),()=>{window.removeEventListener("popstate",x)}}},[o]);const q=()=>{var p;((p=window.history.state)==null?void 0:p.modal)==="moduleManagement"?window.history.back():u(!1)},Z=async()=>{try{const{data:p,error:x}=await k.from("modules").select("*").order("order_index",{ascending:!0});if(x)throw x;s(p||[])}catch(p){console.error("Error fetching modules:",p),v.error("Failed to load modules")}finally{n(!1)}},ee=async()=>{if(!g.title){v.error("Title is required");return}if(!N&&!h){v.error("File is required for new modules");return}D(!0);try{let p=(h==null?void 0:h.file_url)||"",x=(h==null?void 0:h.cover_url)||"";if(N){const E=N.name.split(".").pop(),$=`${Math.random()}.${E}`,{error:H,data:oe}=await k.storage.from("module_files").upload($,N);if(H)throw H;const{data:{publicUrl:me}}=k.storage.from("module_files").getPublicUrl($);p=me}let y=g.sub_category;g.sub_category==="new"&&g.new_sub_category&&(y=g.new_sub_category);const m={title:g.title,file_url:p,cover_url:x,course_category:g.course_category,sub_category:y,is_visible:g.is_visible,order_index:h?h.order_index:a.length};if(h){const{error:E}=await k.from("modules").update(m).eq("id",h.id);if(E)throw E;v.success("Module updated")}else{const{error:E}=await k.from("modules").insert([m]);if(E)throw E;v.success("Module added")}q(),I(null),C({title:"",course_category:l,sub_category:"None",new_sub_category:"",cover_title:"",is_visible:!0,order_index:0}),Z()}catch(p){console.error("Error saving module:",p),v.error(`Failed to save module: ${p.message}`)}finally{D(!1)}},he=async p=>{if(confirm("Are you sure you want to delete this module?"))try{const{error:x}=await k.from("modules").delete().eq("id",p);if(x)throw x;v.success("Module deleted"),Z()}catch(x){console.error("Error deleting module:",x),v.error("Failed to delete module")}},ae=async p=>{try{const{error:x}=await k.from("modules").update({is_visible:!p.is_visible}).eq("id",p.id);if(x)throw x;Z()}catch(x){console.error("Error updating visibility:",x),v.error("Failed to update visibility")}},M=async p=>{if(confirm(`Are you sure you want to delete category "${p}"? This will delete ALL modules in this category!`))try{const{error:x}=await k.from("modules").delete().eq("course_category",l).eq("sub_category",p);if(x)throw x;v.success(`Category "${p}" and its modules deleted`),Z()}catch(x){console.error("Error deleting category:",x),v.error(`Failed to delete category: ${x.message}`)}},O=async()=>{if(!(!V||!V.new.trim()))try{const{error:p}=await k.from("modules").update({sub_category:V.new}).eq("course_category",l).eq("sub_category",V.old);if(p)throw p;v.success("Category updated"),Y(null),Z()}catch(p){console.error("Error updating category:",p),v.error(`Failed to update category: ${p.message}`)}},w=a.filter(p=>p.course_category===l);return e.jsxs(Ie,{className:"w-full shadow-lg",children:[e.jsxs(ys,{className:"flex flex-col gap-4",children:[e.jsx(Ns,{className:"text-primary",children:"Module Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",onClick:()=>L(!0),children:"Manage Categories"}),e.jsxs(P,{onClick:()=>{c(null),C({title:"",course_category:l,sub_category:"None",cover_title:"",is_visible:!0,order_index:a.length}),I(null),u(!0)},className:"bg-primary hover:bg-primary/90",children:[e.jsx(ut,{className:"w-4 h-4 mr-2"}),"Add Module"]})]})]}),e.jsx(Cs,{children:e.jsxs(nr,{value:l,onValueChange:p=>f(p),children:[e.jsxs(Ds,{className:"mb-4 grid w-full grid-cols-2",children:[e.jsx(Dt,{value:"Cinematography",className:"data-[state=active]:bg-primary data-[state=active]:text-white data-[state=inactive]:bg-white data-[state=inactive]:text-primary border border-primary",children:"Cinematography"}),e.jsx(Dt,{value:"Vision",className:"data-[state=active]:bg-primary data-[state=active]:text-white data-[state=inactive]:bg-white data-[state=inactive]:text-primary border border-primary",children:"Vision & Sound Editing"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[w.map(p=>e.jsxs("div",{className:"flex flex-col justify-between p-2 sm:p-4 bg-white border rounded-lg shadow-sm gap-2 h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 overflow-hidden w-full",children:[e.jsxs("div",{className:"w-full sm:w-16 h-32 sm:h-24 bg-slate-900 rounded overflow-hidden flex-shrink-0 shadow-md relative",children:[e.jsx("img",{src:p.course_category==="Cinematography"?"/book_cover_138.png":"/book_cover_137.png",alt:p.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-1",children:e.jsx("h3",{className:"text-emerald-600 font-bold text-center text-[8px] leading-tight drop-shadow-sm bg-white/80 p-0.5 rounded",children:p.title})})]}),e.jsxs("div",{className:"min-w-0 flex-1 w-full",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base line-clamp-2 break-words",children:p.title}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 truncate w-full",children:p.sub_category}),e.jsxs("div",{className:"flex items-center mt-1 space-x-2 flex-wrap gap-y-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p.is_visible?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p.is_visible?t("active"):t("closed")}),e.jsxs("span",{className:"text-xs text-gray-400 whitespace-nowrap",children:[t("orderIndexLabel"),": ",p.order_index]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 pt-2 border-t mt-auto w-full",children:[e.jsxs(P,{variant:"ghost",size:"sm",className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 h-8 px-2",onClick:()=>ae(p),children:[p.is_visible?e.jsx(Le,{className:"h-4 w-4"}):e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:p.is_visible?t("active"):t("closed")})]}),e.jsxs(P,{variant:"ghost",size:"sm",className:"text-admin hover:text-admin hover:bg-admin/10 h-8 px-2",onClick:()=>{c(p),C({new_sub_category:"",title:p.title,course_category:p.course_category,sub_category:p.sub_category||"None",cover_title:"",is_visible:p.is_visible,order_index:p.order_index}),u(!0)},children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:t("edit")})]}),e.jsxs(P,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10 h-8 px-2",onClick:()=>he(p.id),children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:t("delete")})]})]})]},p.id)),w.length===0&&e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:"No modules found in this category"})]})]})}),e.jsx(we,{open:o,onOpenChange:p=>{p?u(!0):q()},children:e.jsxs(ve,{children:[e.jsx(Se,{children:e.jsx(_e,{children:h?"Edit Module":"Add New Module"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"Title"}),e.jsx(G,{value:g.title,onChange:p=>C({...g,title:p.target.value}),placeholder:"Module Title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"Cover Title (Optional)"}),e.jsx(G,{value:g.cover_title,onChange:p=>C({...g,cover_title:p.target.value}),placeholder:"Text to appear on book cover"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"Sub Category"}),e.jsxs(it,{value:g.sub_category,onValueChange:p=>C({...g,sub_category:p}),children:[e.jsx(Ze,{children:e.jsx(lt,{})}),e.jsxs(Qe,{children:[e.jsx(le,{value:"None",children:"None"}),S.map(p=>e.jsx(le,{value:p,children:p},p)),e.jsx(le,{value:"new",children:"+ Add New Category"})]})]})]}),g.sub_category==="new"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"New Category Name"}),e.jsx(G,{value:g.new_sub_category,onChange:p=>C({...g,new_sub_category:p.target.value}),placeholder:"Enter new category name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"File (PDF, DOCX, PPT)"}),e.jsx(G,{type:"file",onChange:p=>{var x;return I(((x=p.target.files)==null?void 0:x[0])||null)},accept:".pdf,.docx,.doc,.ppt,.pptx"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:"Order Index"}),e.jsx(G,{type:"number",value:g.order_index,onChange:p=>C({...g,order_index:parseInt(p.target.value)||0})})]}),e.jsx(P,{onClick:ee,disabled:_,className:"w-full",children:_?"Uploading...":"Save Module"})]})]})}),e.jsx(we,{open:R,onOpenChange:L,children:e.jsxs(ve,{children:[e.jsx(Se,{children:e.jsxs(_e,{children:["Manage Categories (",l==="Vision"?"Vision & Sound Editing":l,")"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[S.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No custom categories found."}):e.jsx("div",{className:"space-y-2",children:S.map(p=>e.jsx("div",{className:"flex items-center justify-between p-2 border rounded bg-gray-50",children:(V==null?void 0:V.old)===p?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(G,{value:V.new,onChange:x=>Y({...V,new:x.target.value})}),e.jsx(P,{size:"sm",onClick:O,children:e.jsx(_s,{className:"w-4 h-4"})}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>Y(null),children:e.jsx(dt,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:p}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>Y({old:p,new:p}),children:e.jsx(Me,{className:"w-4 h-4 text-blue-600"})}),e.jsx(P,{size:"sm",variant:"ghost",onClick:()=>M(p),children:e.jsx(Xe,{className:"w-4 h-4 text-red-600"})})]})]})},p))}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:'To add a new category, use the "Add Module" button and select "Add New Category".'}),e.jsx(P,{className:"w-full",variant:"outline",onClick:()=>L(!1),children:"Close"})]})]})]})})]})},mo=()=>{const{t}=tt(),[a,s]=r.useState([]),[d,n]=r.useState(!0),[o,u]=r.useState(!1),[h,c]=r.useState(!1),[l,f]=r.useState(null),[g,C]=r.useState(""),[N,I]=r.useState(null),[_,D]=r.useState(),[S,A]=r.useState(),R=r.useRef(null),[L,V]=r.useState(null);r.useEffect(()=>{Y(),q();const y=k.channel("public:hero_slider_admin").on("postgres_changes",{event:"*",schema:"public",table:"hero_slider"},()=>{q()}).subscribe();return()=>{k.removeChannel(y)}},[]);const Y=()=>{if(!k||!k.storage){I("Supabase client is not fully initialized. Storage is missing.");return}},q=async()=>{n(!0);try{if(!k||!k.from)throw new Error("Supabase client not initialized");const{data:y,error:m}=await k.from("hero_slider").select("*").order("sort_order",{ascending:!0});if(m)throw m;s(y||[])}catch(y){console.error("Error fetching slider images:",y),y.code!=="PGRST116"&&v.error(`Failed to load slider images: ${y.message}`)}finally{n(!1)}},Z=async y=>{try{const m=!y.is_active,{error:E}=await k.from("hero_slider").update({is_active:m}).eq("id",y.id);if(E)throw E;s(a.map($=>$.id===y.id?{...$,is_active:m}:$)),v.success(m?"Image is now visible":"Image is now hidden")}catch(m){console.error("Error toggling visibility:",m),v.error("Failed to update visibility")}},ee=async y=>new Promise((m,E)=>{const $=new FileReader;$.readAsDataURL(y),$.onload=H=>{var me;const oe=new Image;oe.src=(me=H.target)==null?void 0:me.result,oe.onload=()=>{const ue=document.createElement("canvas"),Pe=ue.getContext("2d");if(!Pe){m(y);return}const ie=2560,F=1440;let z=oe.width,re=oe.height;z>re?z>ie&&(re*=ie/z,z=ie):re>F&&(z*=F/re,re=F),ue.width=z,ue.height=re,Pe.drawImage(oe,0,0,z,re),ue.toBlob(W=>{if(W){const Q=y.name.replace(/\.[^/.]+$/,"")+".jpg",J=new File([W],Q,{type:"image/jpeg",lastModified:Date.now()});m(J)}else m(y)},"image/jpeg",.95)},oe.onerror=ue=>E(ue)},$.onerror=H=>E(H)}),he=y=>{var E;const m=(E=y.target.files)==null?void 0:E[0];if(m){f(m);const $=new FileReader;$.onloadend=()=>{C($.result)},$.readAsDataURL(m)}},ae=async()=>{if(!S||!R.current)return null;const y=R.current,m=document.createElement("canvas"),E=m.getContext("2d");if(!E)return null;const $=y.naturalWidth/y.width,H=y.naturalHeight/y.height;return m.width=S.width,m.height=S.height,E.drawImage(y,S.x*$,S.y*H,S.width*$,S.height*H,0,0,S.width,S.height),new Promise(oe=>{m.toBlob(me=>{oe(me)},"image/jpeg",.95)})},M=async()=>{const y=await ae();if(y){const m=new File([y],"cropped-image.jpg",{type:"image/jpeg"});f(m),C(URL.createObjectURL(y)),D(void 0),A(void 0),v.success("Image cropped successfully")}},O=async()=>{if(!l){v.error("Please select an image");return}c(!0);try{const y=await ee(l),{url:m}=await Ee.uploadFile(y,"hero-slider");if(m){if(L){const{error:E}=await k.from("hero_slider").update({image_url:m}).eq("id",L);if(E)throw E;v.success("Image updated successfully")}else{const{error:E}=await k.from("hero_slider").insert([{image_url:m,sort_order:a.length}]);if(E)throw E;v.success("Image uploaded successfully")}u(!1),f(null),C(""),V(null),q()}}catch(y){console.error("Error uploading image:",y);const m=(y==null?void 0:y.message)||(y==null?void 0:y.error_description)||JSON.stringify(y);v.error(`Upload failed: ${m}`)}finally{c(!1)}},w=y=>{V(y.id),C(y.image_url),f(null),u(!0)},p=()=>{V(null),C(""),f(null),u(!0)},x=async y=>{if(confirm("Are you sure you want to delete this image?"))try{const{error:m}=await k.from("hero_slider").delete().eq("id",y);if(m)throw m;v.success("Image deleted successfully"),q()}catch(m){console.error("Error deleting image:",m),v.error("Failed to delete image")}};return e.jsxs(Ie,{className:"w-full shadow-lg mt-6",children:[e.jsxs(ys,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"text-primary",children:t("sliderManagement")}),e.jsx(P,{variant:"ghost",size:"icon",onClick:q,disabled:d,children:e.jsx(an,{className:`h-4 w-4 ${d?"animate-spin":""}`})})]}),e.jsxs(P,{onClick:p,className:"bg-primary hover:bg-primary/90",children:[e.jsx(ut,{className:"mr-2 h-4 w-4"})," ",t("addImage")]})]}),e.jsx(Cs,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.map((y,m)=>e.jsxs("div",{className:"relative group bg-white rounded-lg overflow-hidden shadow-sm border flex flex-col",children:[e.jsx("div",{className:"aspect-video w-full relative",children:e.jsx("img",{src:y.image_url,alt:`Slide ${m+1}`,className:`w-full h-full object-cover ${y.is_active===!1?"opacity-50 grayscale":""}`})}),e.jsxs("div",{className:"p-1.5 flex flex-wrap items-center justify-center gap-1 bg-gray-50 border-t",children:[e.jsx(P,{variant:"outline",size:"icon",className:"h-6 w-6 bg-white hover:bg-gray-100",onClick:()=>w(y),children:e.jsx(Me,{className:"h-3 w-3 text-blue-600"})}),e.jsx(P,{variant:"outline",size:"icon",className:"h-6 w-6 bg-white hover:bg-gray-100",onClick:()=>Z(y),title:y.is_active!==!1?"Hide Image":"Show Image",children:y.is_active!==!1?e.jsx(Le,{className:"h-3 w-3 text-green-600"}):e.jsx(He,{className:"h-3 w-3 text-gray-400"})}),e.jsx(P,{variant:"outline",size:"icon",className:"h-6 w-6 bg-white hover:bg-red-50 border-red-100",onClick:()=>x(y.id),children:e.jsx(Xe,{className:"h-3 w-3 text-red-600"})})]})]},y.id)),N&&e.jsxs("div",{className:"col-span-full p-4 mb-4 bg-red-100 border border-red-400 text-red-700 rounded",children:[e.jsx("strong",{children:"Connection Error:"})," ",N,e.jsx("br",{}),"Please check your internet connection and ensure the app is built with the correct environment variables."]}),a.length===0&&!d&&e.jsxs("div",{className:"col-span-full text-center py-8 text-gray-500 border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"mb-2",children:"No custom slider images found."}),e.jsx("p",{className:"text-sm text-gray-400",children:"The home screen is currently using the default built-in images."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Upload images here to override the defaults."})]})]})}),e.jsx(we,{open:o,onOpenChange:u,children:e.jsxs(ve,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Se,{children:[e.jsx(_e,{children:t(L?"editSlide":"addSlide")}),L&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a new image or crop the existing one to replace it."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{children:t("slideImage")}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(G,{type:"file",accept:"image/*",onChange:he,className:"cursor-pointer"})})]}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative w-full rounded-lg overflow-hidden border bg-black/5",children:e.jsx(At,{crop:_,onChange:(y,m)=>D(m),onComplete:y=>A(y),aspect:void 0,className:"max-h-[60vh]",children:e.jsx("img",{ref:R,src:g,alt:"Preview",className:"max-h-[60vh] w-auto mx-auto object-contain",crossOrigin:"anonymous"})})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(P,{type:"button",variant:"secondary",onClick:M,disabled:!(S!=null&&S.width)||!(S!=null&&S.height),className:"gap-2",children:[e.jsx(ta,{className:"w-4 h-4"}),t("cropSelection")]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(P,{variant:"outline",onClick:()=>u(!1),children:t("cancel")}),e.jsx(P,{onClick:O,disabled:h||!l,className:L?"bg-green-600 hover:bg-green-700 text-white":"",children:h?t("processing"):L?"Update":t("saveSlide")})]})]})]})})]})},po=()=>{const{t}=tt(),[a,s]=r.useState(null),[d,n]=r.useState([""]),[o,u]=r.useState({school_admin_text:""}),[h,c]=r.useState(null),[l,f]=r.useState(""),[g,C]=r.useState(!1),[N,I]=r.useState(),[_,D]=r.useState(),[S,A]=r.useState(""),R=r.useRef(null);Ht(()=>S?(A(""),!0):!1),r.useEffect(()=>{L()},[]);const L=async()=>{try{const{data:M,error:O}=await k.from("school_settings").select("*").limit(1).maybeSingle();if(O){console.error("Error fetching settings:",O);return}if(M){s(M);const w=M.school_phone.split(",").map(p=>p.trim());n(w.length>0?w:[""]),u({school_admin_text:M.school_admin_text}),M.photo_url&&f(M.photo_url)}}catch(M){console.error("Unexpected error fetching settings:",M)}},V=M=>{var w;const O=(w=M.target.files)==null?void 0:w[0];if(O){const p=new FileReader;p.onloadend=()=>{A(p.result)},p.readAsDataURL(O)}},Y=async()=>{if(!_||!R.current)return null;const M=R.current,O=document.createElement("canvas"),w=O.getContext("2d");if(!w)return null;const p=M.naturalWidth/M.width,x=M.naturalHeight/M.height;return O.width=_.width,O.height=_.height,w.drawImage(M,_.x*p,_.y*x,_.width*p,_.height*x,0,0,_.width,_.height),new Promise(y=>{O.toBlob(m=>{y(m)},"image/jpeg",.95)})},q=async()=>{const M=await Y();if(M){const O=new File([M],"cropped-image.jpg",{type:"image/jpeg"});c(O),f(URL.createObjectURL(M)),A(""),v.success("Image cropped successfully")}},Z=()=>{n([...d,""])},ee=M=>{d.length>1&&n(d.filter((O,w)=>w!==M))},he=(M,O)=>{const w=[...d];w[M]=O,n(w)},ae=async M=>{M.preventDefault();const O=d.filter(w=>w.trim());if(O.length===0||!o.school_admin_text.trim()){v.error("Please add at least one phone number and contact text");return}C(!0);try{let w=a==null?void 0:a.photo_url;h&&(w=(await Ee.uploadFile(h)).url);const p=O.join(", ");if(a){const{error:x}=await k.from("school_settings").update({school_phone:p,school_admin_text:o.school_admin_text.trim(),photo_url:w,updated_at:new Date().toISOString()}).eq("id",a.id);if(x)throw x;v.success("Contact information updated successfully!")}else{const{error:x}=await k.from("school_settings").insert({school_phone:p,school_admin_text:o.school_admin_text.trim(),photo_url:w});if(x)throw x;v.success("Contact information saved successfully!")}L()}catch(w){console.error("Error:",w),v.error("Failed to save contact information: "+w.message)}finally{C(!1)}};return e.jsxs(Ie,{className:"p-4 sm:p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(rn,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-primary",children:t("contactInformationManagementTitle")})]}),e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 mb-6",children:[e.jsxs("div",{className:"relative",children:[l?e.jsx("img",{src:l,alt:"School Admin",className:"w-24 h-24 rounded-full object-cover border-4 border-admin"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-muted flex items-center justify-center border-4 border-admin",children:e.jsx(ct,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("label",{htmlFor:"photo-upload",className:"absolute bottom-0 right-0 p-1.5 bg-admin rounded-full text-white cursor-pointer hover:bg-admin/90 transition-colors shadow-lg",children:[e.jsx(Ps,{className:"w-3 h-3"}),e.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",className:"hidden",onChange:V})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("uploadPhoto")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:t("schoolPhoneNumbersLabel")}),e.jsxs(P,{type:"button",onClick:Z,size:"sm",variant:"outline",className:"gap-1 text-admin border-admin",children:[e.jsx(ut,{className:"w-3 h-3"}),t("addPhoneNumberButton")]})]}),e.jsx("div",{className:"space-y-2",children:d.map((M,O)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{type:"tel",placeholder:"e.g., +251-XXX-XXX-XXX",value:M,onChange:w=>he(O,w.target.value),required:!0}),d.length>1&&e.jsx(P,{type:"button",variant:"ghost",size:"icon",onClick:()=>ee(O),className:"text-destructive",children:e.jsx(dt,{className:"w-4 h-4"})})]},O))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:t("contactTextLabel")}),e.jsx(G,{type:"text",placeholder:t("contactTextPlaceholder"),value:o.school_admin_text,onChange:M=>u({...o,school_admin_text:M.target.value}),required:!0})]}),e.jsxs(P,{type:"submit",className:"w-full bg-admin hover:bg-admin/90 gap-2",disabled:g,children:[e.jsx(_s,{className:"w-4 h-4"}),t(g?"savingLabel":"saveContactInformationButton")]})]}),a&&e.jsxs("div",{className:"mt-4 p-3 bg-muted/30 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:t("currentSettingsLabel")}),e.jsxs("p",{className:"text-sm",children:["ðŸ“ž ",a.school_phone]}),e.jsxs("p",{className:"text-sm mt-1",children:["ðŸ“ ",a.school_admin_text]})]}),e.jsx(we,{open:!!S,onOpenChange:()=>A(""),children:e.jsxs(ve,{className:"sm:max-w-[600px]",children:[e.jsx(Se,{children:e.jsx(_e,{children:t("cropImage")})}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[S&&e.jsx(At,{crop:N,onChange:(M,O)=>I(O),onComplete:M=>D(M),aspect:1,circularCrop:!0,children:e.jsx("img",{ref:R,alt:"Crop me",src:S,onLoad:M=>{const{width:O,height:w}=M.currentTarget,p=Math.min(O,w),x=(O-p)/2,y=(w-p)/2;I({unit:"px",x,y,width:p,height:p})},className:"max-h-[60vh] object-contain"})}),e.jsxs("div",{className:"flex gap-2 justify-end w-full",children:[e.jsx(P,{variant:"outline",onClick:()=>A(""),children:t("cancel")}),e.jsx(P,{onClick:q,children:t("applyCrop")})]})]})]})})]})},go=()=>{const{t}=tt(),[a,s]=r.useState(!0),[d,n]=r.useState(!0);r.useEffect(()=>{o()},[]);const o=async()=>{try{const{data:h,error:c}=await k.from("school_settings").select("is_portal_enabled").maybeSingle();if(c)throw c;h&&s(h.is_portal_enabled??!0)}catch(h){console.error("Error fetching portal settings:",h),v.error("Failed to load portal settings")}finally{n(!1)}},u=async h=>{s(h);try{const{data:c}=await k.from("school_settings").select("id").maybeSingle();let l;if(c){const{error:f}=await k.from("school_settings").update({is_portal_enabled:h}).eq("id",c.id);l=f}else{const{error:f}=await k.from("school_settings").insert({is_portal_enabled:h});l=f}if(l)throw l;v.success(t(h?"portalEnabledToast":"portalDisabledToast"))}catch(c){console.error("Error updating portal settings:",c),v.error("Failed to update portal settings"),s(!h)}};return e.jsx(Ie,{className:"p-6 shadow-lg border-l-4 border-l-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${a?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(nn,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:t("studentPortalAccess")}),e.jsx("p",{className:"text-sm text-gray-500",children:t(a?"portalActiveMessage":"portalClosedMessageAdmin")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-sm font-medium ${a?"text-blue-600":"text-gray-500"}`,children:[a?e.jsx(sa,{className:"w-4 h-4 inline mr-1"}):e.jsx(us,{className:"w-4 h-4 inline mr-1"}),t(a?"active":"closed")]}),e.jsx(Es,{checked:a,onCheckedChange:u,disabled:d})]})]})})},xo=({open:t,onOpenChange:a})=>{const[s,d]=r.useState(""),[n,o]=r.useState(""),[u,h]=r.useState(""),[c,l]=r.useState(!1),[f,g]=r.useState(!1),[C,N]=r.useState(!1),[I,_]=r.useState(!1),[D,S]=r.useState("");r.useEffect(()=>{t&&A()},[t]);const A=async()=>{const{data:L}=await k.from("admin_settings").select("admin_password").single();L&&S(L.admin_password)},R=async L=>{if(L.preventDefault(),s!==D){v.error("Old password is incorrect");return}if(n.length<4){v.error("New password must be at least 4 characters");return}if(n!==u){v.error("New passwords do not match");return}_(!0);try{const{data:V}=await k.from("admin_settings").select("id").single();if(V){const{error:Y}=await k.from("admin_settings").update({admin_password:n,updated_at:new Date().toISOString()}).eq("id",V.id);if(Y)throw Y}else{const{error:Y}=await k.from("admin_settings").insert({admin_password:n});if(Y)throw Y}v.success("Password changed successfully!"),d(""),o(""),h(""),a(!1)}catch(V){console.error("Error changing password:",V),v.error("Failed to change password")}finally{_(!1)}};return e.jsx(we,{open:t,onOpenChange:a,children:e.jsxs(ve,{className:"max-w-md",children:[e.jsx(Se,{children:e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"w-5 h-5 text-admin"}),"Change Admin Password"]})}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Old Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:c?"text":"password",value:s,onChange:L=>d(L.target.value),placeholder:"Enter current password",required:!0,className:"pr-10"}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>l(!c),children:c?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:f?"text":"password",value:n,onChange:L=>o(L.target.value),placeholder:"Enter new password",required:!0,className:"pr-10"}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>g(!f),children:f?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:C?"text":"password",value:u,onChange:L=>h(L.target.value),placeholder:"Re-enter new password",required:!0,className:"pr-10"}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>N(!C),children:C?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(P,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(P,{type:"submit",className:"bg-admin hover:bg-admin/90",disabled:I,children:I?"Changing...":"Change Password"})]})]})]})})},fo=({open:t,onOpenChange:a})=>{const[s,d]=r.useState(""),[n,o]=r.useState(""),[u,h]=r.useState(!1),[c,l]=r.useState(!1),[f,g]=r.useState(!1),C=async N=>{if(N.preventDefault(),s!==n){v.error("New passwords do not match");return}if(s.length<6){v.error("Password must be at least 6 characters");return}g(!0);try{const{error:I}=await k.from("admin_settings").update({news_admin_password:s}).eq("id",1);if(I){const{data:_}=await k.from("admin_settings").select("id").limit(1).single();if(_){const{error:D}=await k.from("admin_settings").update({news_admin_password:s}).eq("id",_.id);if(D)throw D}else throw I}v.success("News Admin password updated successfully"),a(!1),d(""),o("")}catch(I){console.error("Error updating password:",I),v.error("Failed to update password")}finally{g(!1)}};return e.jsx(we,{open:t,onOpenChange:a,children:e.jsxs(ve,{className:"sm:max-w-[425px]",children:[e.jsx(Se,{children:e.jsx(_e,{children:"Change News Admin Password"})}),e.jsxs("form",{onSubmit:C,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:u?"text":"password",value:s,onChange:N=>d(N.target.value),required:!0,className:"pr-10"}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>h(!u),children:u?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:c?"text":"password",value:n,onChange:N=>o(N.target.value),required:!0,className:"pr-10"}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>l(!c),children:c?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]})]}),e.jsx(P,{type:"submit",className:"w-full bg-admin hover:bg-admin/90",disabled:f,children:f?"Updating...":"Update Password"})]})]})})},wo=({open:t,onOpenChange:a})=>{const[s,d]=r.useState(""),[n,o]=r.useState(""),[u,h]=r.useState(!1),[c,l]=r.useState(!1),[f,g]=r.useState(!1),C=async N=>{if(N.preventDefault(),s!==n){v.error("New passwords do not match");return}if(s.length<6){v.error("Password must be at least 6 characters");return}g(!0);try{const{error:I}=await k.from("admin_settings").update({student_admin_password:s}).eq("id",1);if(I){if(console.error("Update error:",I),I.code==="42703"){v.error("Database column missing. Please run the migration script."),g(!1);return}const{data:_}=await k.from("admin_settings").select("id").limit(1).single();if(_){const{error:D}=await k.from("admin_settings").update({student_admin_password:s}).eq("id",_.id);if(D){if(D.code==="42703")v.error("Database column missing. Please run the migration script.");else throw D;g(!1);return}}else throw I}v.success("Student Admin password updated successfully"),a(!1),d(""),o("")}catch(I){console.error("Error updating password:",I),v.error("Failed to update password")}finally{g(!1)}};return e.jsx(we,{open:t,onOpenChange:a,children:e.jsxs(ve,{className:"sm:max-w-[425px]",children:[e.jsx(Se,{children:e.jsx(_e,{children:"Change Student Admin Password"})}),e.jsxs("form",{onSubmit:C,className:"space-y-4 mt-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:u?"text":"password",placeholder:"New Password",value:s,onChange:N=>d(N.target.value),required:!0}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>h(!u),children:u?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:c?"text":"password",placeholder:"Confirm New Password",value:n,onChange:N=>o(N.target.value),required:!0}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>l(!c),children:c?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]})}),e.jsx(P,{type:"submit",className:"w-full bg-admin hover:bg-admin/90",disabled:f,children:f?"Updating...":"Update Password"})]})]})})},Tt="__divider__",vs=["None","Basic / Premiere Pro Exam 1 ( Theory )","Basic / Premiere Pro Exam 2 ( Practical )","Basic / Premiere Pro Exam 3 ( Practical )",Tt,"Basic / Photoshop Exam 1 ( Theory )","Basic / Photoshop Exam 2 ( Practical )","Basic / Photoshop Exam 3 ( Practical )","Continuous Assessment"],bs=["None","Cinematography ( Theory 1 )","Cinematography ( Theory 2 )","Shot List","Practical Exam","Simple Shot","Final Project",Tt,"Shooting Material","Practical Exam","Project",Tt,"Light Theory","Dramatic scene","Project","Participation & Attendance","Continuous Assessment"];Array.from(new Set([...vs,...bs.filter(t=>t!==Tt)]));const cs="__custom__",Ys=t=>{var s;return t?t.code==="42703"?!0:(((s=t.message)==null?void 0:s.toLowerCase())??"").includes("show_final_grade_letter"):!1},Eo=()=>{const{t}=tt(),[a,s]=r.useState(""),[d,n]=r.useState(!1),[o,u]=r.useState(!1),[h,c]=r.useState(null),[l,f]=r.useState("students"),[g,C]=r.useState([]),[N,I]=r.useState({studentId:"",name:"",batchNumber:"",gender:"",password:""}),[_,D]=r.useState([{subject:"",grade:"",outOf:"",isCustom:!1,course:"cinematography"}]),[S,A]=r.useState(null),[R,L]=r.useState(""),[V,Y]=r.useState(""),[q,Z]=r.useState(),[ee,he]=r.useState(),[ae,M]=r.useState(""),O=r.useRef(null),[w,p]=r.useState(!1),[x,y]=r.useState(""),[m,E]=r.useState(null),[$,H]=r.useState(!1),[oe,me]=r.useState(""),[ue,Pe]=r.useState(""),[ie,F]=r.useState("all"),[z,re]=r.useState("all"),[W,Q]=r.useState("all"),[J,Oe]=r.useState(!1),[qe,pt]=r.useState(""),[gt,rt]=r.useState(!1),[Ts,Wt]=r.useState(!1),[As,Jt]=r.useState(!1),[vo,Rs]=r.useState("SuperAdmin#2018"),[bo,Ms]=r.useState("NewsAdmin@2018"),[jo,or]=r.useState("StudetAdmin@2019");r.useState({});const[ir,Ls]=r.useState(!1),[Zt,Rt]=r.useState(null),[Qt,es]=r.useState(""),[Ge,Ct]=r.useState("cinematography"),[ge,St]=r.useState("cinematography"),[ts,ss]=r.useState(null),xt=on();r.useEffect(()=>{xt&&xt.pathname&&(xt.pathname.toLowerCase().includes("/admin/cinematography")?(Ct("cinematography"),St("cinematography")):(xt.pathname.toLowerCase().includes("/admin/video-editing")||xt.pathname.toLowerCase().includes("/admin/videoediting"))&&(Ct("videoediting"),St("videoediting")))},[xt.pathname]);const ft=i=>i==="cinematography"||i==="videoediting"?i:null,nt=()=>ts??(Ge==="all"?"cinematography":Ge),lr=i=>{if(!i||i.length===0)return null;let b=0,j=0;return i.forEach(T=>{const U=ft(T.course);U==="cinematography"&&(b+=1),U==="videoediting"&&(j+=1)}),!b&&!j?null:b===j?Ge==="videoediting"?"videoediting":"cinematography":b>j?"cinematography":"videoediting"},cr=(i,b)=>{const j=ft(i.course);return b==="cinematography"?!j||j==="cinematography":j==="videoediting"},[as,Fs]=r.useState(()=>{const i=localStorage.getItem("dismissedComments");return i?JSON.parse(i):[]}),[wt,rs]=r.useState(null),[dr,_t]=r.useState(0),[Os,ur]=r.useState(0),[ns,hr]=r.useState({show_grade_letters:!0,show_admin_avg_grades:!0}),[Mt,mr]=r.useState(null);r.useEffect(()=>{(async()=>{try{const b=await apiClient.getSchoolSettings();b&&hr({show_grade_letters:b.show_grade_letters??!0,show_admin_avg_grades:b.show_admin_avg_grades??!0})}catch(b){console.error("Failed to fetch settings",b)}})()},[]),r.useEffect(()=>{const i=localStorage.getItem("adminLockoutEndTime"),b=localStorage.getItem("adminFailedAttempts");if(i){const j=parseInt(i);j>Date.now()?rs(j):localStorage.removeItem("adminLockoutEndTime")}b&&_t(parseInt(b))},[]),r.useEffect(()=>{if(wt&&wt>Date.now()){const i=setInterval(()=>{const b=Math.ceil((wt-Date.now())/1e3);b<=0?(rs(null),localStorage.removeItem("adminLockoutEndTime"),window.location.href="/"):ur(b)},1e3);return()=>clearInterval(i)}},[wt]),Ht(()=>ae?(M(""),!0):m?(E(null),H(!1),!0):gt?(rt(!1),!0):Ts?(Wt(!1),!0):As?(Jt(!1),!0):!1),r.useEffect(()=>{(async()=>{try{const{data:T,error:U}=await k.from("admin_settings").select("admin_password, news_admin_password, student_admin_password").single();if(U){if(U.code==="42703"){console.warn("Student admin column missing, fetching legacy columns");const{data:B}=await k.from("admin_settings").select("admin_password, news_admin_password").single();B&&(Rs(B.admin_password),B.news_admin_password&&Ms(B.news_admin_password));return}throw U}T&&(Rs(T.admin_password),T.news_admin_password&&Ms(T.news_admin_password),T.student_admin_password&&or(T.student_admin_password))}catch(T){console.error("Error fetching admin settings:",T)}})();const b=sessionStorage.getItem("adminAuthenticated")==="true",j=sessionStorage.getItem("adminRole");b&&(u(!0),c(j||"super_admin"),j==="news_admin"?f("management"):j==="student_admin"&&f("students"))},[]),r.useEffect(()=>{if(o){Ne();const i=k.channel("students-changes").on("postgres_changes",{event:"*",schema:"public",table:"students"},()=>{Ne()}).subscribe(),b=k.channel("grades-changes").on("postgres_changes",{event:"*",schema:"public",table:"grades"},()=>{Ne()}).subscribe(),j=k.channel("comments-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"comments"},T=>{Ne(),T.new&&T.new.sender_type==="student"&&(ds(),v.info("New message from student",{description:"Check the student comments section"}))}).subscribe();return()=>{k.removeChannel(i),k.removeChannel(b),k.removeChannel(j)}}},[o]);const pr=async i=>{i.preventDefault();const{data:b}=await k.from("admin_settings").select("admin_password, news_admin_password, student_admin_password").single(),j=(b==null?void 0:b.admin_password)||"SuperAdmin#2018",T=(b==null?void 0:b.news_admin_password)||"NewsAdmin@2018",U=(b==null?void 0:b.student_admin_password)||"StudetAdmin@2019";if(a===j)u(!0),c("super_admin"),sessionStorage.setItem("adminAuthenticated","true"),sessionStorage.setItem("adminRole","super_admin"),_t(0),localStorage.removeItem("adminFailedAttempts"),v.success("Login successful!"),s("");else if(a===T)u(!0),c("news_admin"),f("management"),sessionStorage.setItem("adminAuthenticated","true"),sessionStorage.setItem("adminRole","news_admin"),_t(0),localStorage.removeItem("adminFailedAttempts"),v.success("Login successful as News Admin!"),s("");else if(a===U)u(!0),c("student_admin"),f("students"),sessionStorage.setItem("adminAuthenticated","true"),sessionStorage.setItem("adminRole","student_admin"),_t(0),localStorage.removeItem("adminFailedAttempts"),v.success("Login successful as Student Admin!"),s("");else{navigator.vibrate&&navigator.vibrate([100,50,100,50,100]);const B=dr+1;_t(B),localStorage.setItem("adminFailedAttempts",B.toString());let K=0;if(B===2?K=30*1e3:B===3?K=60*1e3:B===4?K=90*1e3:B>4&&(K=30*1e3),K>0){const ce=Date.now()+K;rs(ce),localStorage.setItem("adminLockoutEndTime",ce.toString()),v.error(`Incorrect password. Locked for ${K/1e3}s`)}else v.error(`Incorrect password. ${2-B} attempts remaining.`)}},gr=()=>{u(!1),c(null),sessionStorage.removeItem("adminAuthenticated"),sessionStorage.removeItem("adminRole"),v.success("Logged out successfully")},xr=async(i,b)=>{const{error:j}=await k.from("students").update({locked:!b}).eq("student_id",i);j?v.error("Failed to update lock status"):(Ne(),v.success(b?"Student unlocked":"Student locked"))},fr=async(i,b)=>{const j=await k.from("students").update({show_final_grade_letter:b}).eq("student_id",i);if(!j.error){v.success(b?"Grade letter shown to student":"Grade letter hidden from student"),Ne();return}if(!Ys(j.error)){console.error("Grade letter toggle error",j.error),v.error("Failed to update grade letter visibility");return}const{data:T,error:U}=await k.from("students").select("name").eq("student_id",i).single();if(U||!T){console.error("Unable to fetch student name for fallback",U),v.error("Failed to update grade letter visibility");return}const B=fn(T.name,b),K=await k.from("students").update({name:B}).eq("student_id",i);if(K.error){console.error("Legacy grade letter update failed",K.error),v.error("Failed to update grade letter visibility");return}v.success(b?"Grade letter shown to student":"Grade letter hidden from student"),Ne()},Bs=async i=>{try{const b=g.map(T=>({...T,show_final_grade_letter:i}));C(b);const{error:j}=await k.from("students").update({show_final_grade_letter:i}).neq("student_id","_______");if(j){if(Ys(j)){v.error("Bulk update requires database column migration"),Ne();return}throw j}v.success(t(i?"gradeLetterOnAll":"gradeLetterOffAll")),Ne()}catch(b){console.error("Bulk toggle error:",b),v.error("Failed to update all students"),Ne()}},wr=async()=>{if(!m)return;const i=ge==="all"?m.grades||[]:(m.grades||[]).filter(j=>(j.course||"").toLowerCase()===ge.toLowerCase());if(!i||i.length===0){v.error("No grades to export for this student (in current course view)");return}const b=It(i.map(j=>Number(j.grade)));try{const j=await wn({name:m.name,student_id:m.student_id,batch_number:m.batch_number},i.map(T=>({subject:T.subject,grade:T.grade,total:T.total})),b,{openInNewTab:!1,showGradeLetter:!!m.show_final_grade_letter,courseTitle:ge==="cinematography"?"Cinematography":ge==="videoediting"?"Vision & Sound Editing":"All",logoPath:"/Bilal%20Videography%20Logo%20only%20white.png"});j!=null&&j.saved?v.success("PDF download started"):v.info("PDF opened")}catch(j){console.error("Export error",j),v.error("Failed to export PDF")}},Ne=async()=>{const{data:i}=await k.from("students").select("*").order("student_id");if(i){const b=await Promise.all(i.map(async j=>{const{data:T}=await k.from("grades").select("id, student_id, subject, grade").eq("student_id",j.student_id),U=ln(j.name),B=U.realName,K=U.batch,ce=U.gender,ne=typeof j.show_final_grade_letter=="boolean"?j.show_final_grade_letter:!!U.showGradeLetter,be=j.course||U.course||void 0,Be=(T||[]).map(Ae=>{const te=Ae.subject.split("|||");return te.length>=3&&(te[0]==="cinematography"||te[0]==="videoediting")?{...Ae,course:te[0],subject:te[1],total:te[2]}:te.length===2&&(te[0]==="cinematography"||te[0]==="videoediting")?{...Ae,course:te[0],subject:te[1],total:void 0}:te.length>1?{...Ae,subject:te[0],total:te[1],course:Ae.course||be}:{...Ae,course:Ae.course||be}}),{data:$e}=await k.from("comments").select("*").eq("student_id",j.student_id).order("created_at",{ascending:!0});return{...j,name:B,batch_number:K,gender:ce||j.gender||void 0,show_final_grade_letter:ne,course:be,grades:Be,comments:$e||[]}}));C(b)}},vr=i=>{var j;const b=(j=i.target.files)==null?void 0:j[0];if(b){const T=new FileReader;T.onloadend=()=>{M(T.result)},T.readAsDataURL(b)}},br=async()=>{if(!ee||!O.current)return null;const i=O.current,b=document.createElement("canvas"),j=b.getContext("2d");if(!j)return null;const T=i.naturalWidth/i.width,U=i.naturalHeight/i.height;return b.width=ee.width,b.height=ee.height,j.drawImage(i,ee.x*T,ee.y*U,ee.width*T,ee.height*U,0,0,ee.width,ee.height),new Promise(B=>{b.toBlob(K=>{B(K)},"image/jpeg",.95)})},jr=async()=>{const i=await br();if(i){const b=new File([i],"cropped-image.jpg",{type:"image/jpeg"});A(b),L(URL.createObjectURL(i)),M(""),v.success("Image cropped successfully")}},yr=async i=>{if(!S)return null;const b=S.name.split(".").pop(),T=`${`${i}-${Date.now()}.${b}`}`,{error:U}=await k.storage.from("student-photos").upload(T,S);if(U)return console.error("Upload error:",U),v.error("Failed to upload photo"),null;const{data:B}=k.storage.from("student-photos").getPublicUrl(T);return B.publicUrl},Nr=async i=>{i.preventDefault();const{studentId:b,name:j,batchNumber:T,gender:U}=N,B=b.trim().toUpperCase(),K=g.find(ne=>ne.student_id===B);if(!B||!j.trim()){v.error("Please enter student ID and name");return}if(!U){v.error(t("genderRequiredMessage"));return}const ce=_.filter(ne=>ne.subject.trim()&&ne.grade.trim());for(const ne of ce){const be=parseFloat(ne.grade);if(isNaN(be)||be<0){v.error("Grades must be valid positive numbers");return}}Ls(!0);try{const ne=X=>ft(X.course)||nt();let be=null;S&&(be=await yr(B));const Be=[];T.trim()&&Be.push(`batch=${T.trim()}`),Be.push(`gender=${U}`);const $e=nt();$e&&Be.push(`course=${$e}`);const Ae=[j.trim(),...Be].join("|||"),te={student_id:B,name:Ae,password:N.password||(K==null?void 0:K.password)||null};$e&&(te.course=$e),be&&(te.photo_url=be);try{const{error:X}=await k.from("students").upsert(te,{onConflict:"student_id"});if(X)throw X}catch(X){const fe=((X==null?void 0:X.message)||"").toLowerCase(),Re=(X==null?void 0:X.code)==="42703"&&(fe.includes('column "course"')||fe.includes("course")),ke=(X==null?void 0:X.code)==="42703"&&(fe.includes('column "password"')||fe.includes("password"));if(Re&&"course"in te){delete te.course;const{error:je}=await k.from("students").upsert(te,{onConflict:"student_id"});if(je){const Ye=(je.message||"").toLowerCase();if(je.code==="42703"&&(Ye.includes('column "password"')||Ye.includes("password"))&&"password"in te){delete te.password;const{error:ye}=await k.from("students").upsert(te,{onConflict:"student_id"});if(ye)throw ye;v.info("Saved without course/password columns. Please run migrations.")}else throw je}else v.info("Saved without course DB column; using metadata fallback for course.")}else if(ke&&"password"in te){delete te.password;const{error:je}=await k.from("students").upsert(te,{onConflict:"student_id"});if(je)throw je;v.info("Saved without password DB column. Please run migration.")}else throw X}if(J){const X=qe||B,fe=Ge==="all"?"cinematography":Ge,{data:Re,error:ke}=await k.from("grades").select("id, subject").eq("student_id",X);if(ke)throw ke;const je=Ce=>{if(!Ce)return"cinematography";const ye=Ce.split("|||");return ye.length>=2&&(ye[0]==="cinematography"||ye[0]==="videoediting")?ye[0]:"cinematography"},Ye=[];if((Re||[]).forEach(Ce=>{je(Ce.subject)===fe&&Ye.push(Ce.id)}),Ye.length>0){const{error:Ce}=await k.from("grades").delete().in("id",Ye);if(Ce)throw Ce}if(ce.length>0){const{error:Ce}=await k.from("grades").insert(ce.map(ye=>{const Pt=ye.subject.trim();let Ue=ye.outOf?`${Pt}|||${ye.outOf}`:Pt;const Et=ne(ye);return Et&&(Ue=`${Et}|||${Ue}`),{student_id:B,subject:Ue,grade:parseFloat(ye.grade),updated_by:"admin"}}));if(Ce)throw Ce}}else for(const X of ce){const fe=X.subject.trim();let Re=X.outOf?`${fe}|||${X.outOf}`:fe;const ke=ne(X);ke&&(Re=`${ke}|||${Re}`);const{error:je}=await k.from("grades").upsert({student_id:B,subject:Re,grade:parseFloat(X.grade),updated_by:"admin"},{onConflict:"student_id,subject"});if(je)throw je}navigator.vibrate&&navigator.vibrate(50),w?v.success("Student updated successfully!"):v.success("You added new student successfully",{position:"top-center",duration:1500,className:"text-center font-semibold"});const ot=ce.map(X=>{const fe=X.subject.trim(),Re=parseInt(X.grade),ke=ne(X);return{id:`${B}-${ke}-${fe}`,student_id:B,subject:fe,grade:Re,total:X.outOf||void 0,course:ke}});C(X=>{var ke;const fe=X.findIndex(je=>je.student_id===B),Re={student_id:B,name:j.trim(),photo_url:be||void 0,locked:((ke=X[fe])==null?void 0:ke.locked)??!1,batch_number:T.trim()||void 0,gender:U,course:$e};if(fe>=0){const je=J?ot:(()=>{const ye=X[fe].grades||[],Pt=new Map(ye.map(Ue=>[`${ft(Ue.course)||"uncategorized"}::${Ue.subject.toLowerCase()}`,Ue]));for(const Ue of ot){const Et=ft(Ue.course)||"uncategorized";Pt.set(`${Et}::${Ue.subject.toLowerCase()}`,Ue)}return Array.from(Pt.values())})(),Ye={...X[fe],...Re,grades:je},Ce=[...X];return Ce[fe]=Ye,Ce}return[{...Re,grades:ot},...X]}),I({studentId:"",name:"",batchNumber:"",gender:"",password:""}),D([{subject:"",grade:"",outOf:"",isCustom:!1,course:nt()}]),A(null),L(""),M(""),p(!1),y(""),Oe(!1),pt(""),ss(null),Ne()}catch(ne){console.error("Error:",ne),v.error(`Failed to update grade: ${ne.message||"Unknown error"}`)}finally{Ls(!1)}},Cr=i=>{I({studentId:i.student_id,name:i.name,batchNumber:i.batch_number||"",gender:i.gender||"",password:i.password||""}),pt(i.student_id);const b=ge!=="all"?ge:null,j=i.grades||[],T=lr(j),U=i.course||void 0,B=b||T||U||"cinematography",K=j.filter(ce=>cr(ce,B));K.length>0?D(K.map(ce=>{const ne=ce.subject.trim(),be=B==="cinematography"?bs:vs,Be=ot=>ot.toLowerCase().replace(/\s+/g,""),$e=Be(ne),Ae=be.find(ot=>Be(ot)===$e),te=!!Ae;return{subject:Ae||ne,grade:ce.grade.toString(),outOf:ce.total?ce.total.toString():"",isCustom:!te,course:ft(ce.course)||B}})):D([{subject:"",grade:"",outOf:"",isCustom:!1,course:B}]),Ct(B),ss(b?B:null),p(!0),Oe(!0),i.photo_url&&L(i.photo_url),E(null),window.scrollTo({top:0,behavior:"smooth"}),v.info("Editing all grades - Update and save")},Sr=()=>{const i=nt();D([..._,{subject:"",grade:"",outOf:"",isCustom:!1,course:i}])},_r=i=>{_.length>1&&D(_.filter((b,j)=>j!==i))},os=(i,b,j)=>{D(T=>T.map((U,B)=>B===i?{...U,[b]:j}:U))},Pr=(i,b)=>{D(j=>j.map((T,U)=>U!==i?T:b===cs?{...T,subject:"",isCustom:!0,course:T.course||nt()}:{...T,subject:b,isCustom:!1,course:nt()}))},$s=i=>{const b=Ft(i);return["A+","A","A-"].includes(b)?"bg-green-600 text-white":["B+","B","B-"].includes(b)?"bg-green-400 text-gray-900":["C+","C"].includes(b)?"bg-yellow-400 text-gray-900":"bg-red-600 text-white"},Er=Array.from(new Set(g.map(i=>i.batch_number).filter(Boolean))).sort(),Us=g.filter(i=>{var ce;const b=i.name.toLowerCase().includes(oe.toLowerCase())||i.student_id.toLowerCase().includes(oe.toLowerCase()),j=z==="all"||i.batch_number===z,T=W==="all"||((ce=i.gender)==null?void 0:ce.toLowerCase())===W.toLowerCase();if(!b||!j||!T)return!1;if(ge!=="all"){const ne=(i.grades||[]).some($e=>($e.course||"").toLowerCase()===ge.toLowerCase()),be=i.course,Be=be&&be.toLowerCase()===ge.toLowerCase();if(!ne&&!Be)return!1}if(ie==="all")return!0;const U=i.grades||[];if(U.length===0)return!1;const B=It(U.map(ne=>ne.grade)),K=Ft(B);return ie==="a+"?K==="A+":ie==="a"?K==="A":ie==="a-"?K==="A-":ie==="b+"?K==="B+":ie==="b"?K==="B":ie==="b-"?K==="B-":ie==="c+"?K==="C+":ie==="c"?K==="C":ie==="non_compitant"?K==="NON CMPITANT":!0}),Ir=[...Us].sort((i,b)=>{if(!Mt)return 0;const j=B=>{const K=B.grades||[],ce=ge==="all"?K:K.filter(ne=>(ne.course||"").toLowerCase()===ge.toLowerCase());return ce.length>0?It(ce.map(ne=>ne.grade)):0},T=j(i),U=j(b);return Mt==="asc"?T-U:U-T}),kr=async(i,b)=>{if(window.confirm(`Are you sure you want to delete all data for ${b} (${i})?`))try{const{error:j}=await k.from("students").delete().eq("student_id",i);if(j)throw j;C(T=>T.filter(U=>U.student_id===void 0?!0:U.student_id!==i)),v.success(`Deleted ${b}`),Ne()}catch(j){console.error("Error:",j),v.error("Failed to delete student")}},Dr=async i=>{try{const{error:b}=await k.from("comments").delete().eq("id",i);if(b)throw b;if(v.success("Message deleted"),m){const{data:j}=await k.from("comments").select("*").eq("student_id",m.student_id).order("created_at",{ascending:!0});E(T=>T?{...T,comments:j||[]}:null)}}catch(b){console.error("Error deleting comment:",b),v.error("Failed to delete message")}},Tr=async()=>{if(!(!Zt||!Qt.trim()))try{const{error:i}=await k.from("comments").update({message:Qt.trim()}).eq("id",Zt.id);if(i)throw i;if(v.success("Message updated"),Rt(null),es(""),m){const{data:b}=await k.from("comments").select("*").eq("student_id",m.student_id).order("created_at",{ascending:!0});E(j=>j?{...j,comments:b||[]}:null)}}catch(i){console.error("Error updating comment:",i),v.error("Failed to update message")}},Ar=async i=>{if(ue.trim())try{const{error:b}=await k.from("comments").insert({student_id:i,message:ue.trim(),sender_type:"teacher"});if(b)throw b;if(Pe(""),v.success(t("replySent")),m){const{data:j}=await k.from("comments").select("*").eq("student_id",m.student_id).order("created_at",{ascending:!0});E(T=>T?{...T,comments:j||[]}:null)}Ne()}catch(b){console.error("Error sending reply:",b),v.error(t("replyFailed"))}};if(wt&&wt>Date.now())return e.jsxs("div",{className:"fixed inset-0 z-50 bg-[#0c9488] flex flex-col items-center justify-center text-white p-4 animate-in fade-in duration-300",children:[e.jsx("div",{className:"bg-white/20 p-6 rounded-full mb-6 animate-pulse",children:e.jsx(us,{className:"w-16 h-16 sm:w-24 sm:h-24"})}),e.jsx("h2",{className:"text-2xl sm:text-4xl font-bold mb-4 text-center",children:t("appLockedTitle")}),e.jsx("p",{className:"text-lg sm:text-xl mb-8 text-center max-w-md",children:t("appLockedMessage")}),e.jsxs("div",{className:"text-4xl sm:text-6xl font-mono font-bold bg-black/20 px-6 py-3 rounded-xl",children:[Math.floor(Os/60),":",(Os%60).toString().padStart(2,"0")]}),e.jsx("p",{className:"mt-8 text-sm opacity-80",children:t("appLockedFooter")})]});if(!o)return e.jsx("div",{className:"min-h-screen p-4 flex items-start justify-center pt-12",children:e.jsxs(Ie,{className:"w-full max-w-md p-6 sm:p-8 shadow-lg bg-white",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-3",children:e.jsx(ct,{className:"w-10 h-10 text-primary"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-center text-primary",children:t("adminAccessTitle")}),e.jsx("p",{className:"text-primary/80 text-center mt-1 font-medium",children:t("adminAccessSubtitle")})]}),e.jsxs("form",{onSubmit:pr,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(G,{type:d?"text":"password",value:a,onChange:i=>s(i.target.value),placeholder:t("passwordPlaceholder"),required:!0,className:"pr-10 border-primary/20 focus-visible:ring-primary"}),e.jsx(P,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent text-primary/60 hover:text-primary",onClick:()=>n(!d),children:d?e.jsx(He,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})})]}),e.jsx(P,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:t("signIn")})]})]})});const vt=m?ge==="all"?m.grades:m.grades.filter(i=>(i.course||"").toLowerCase()===ge.toLowerCase()):[],Rr=Ge==="cinematography"?bs:vs,Mr=ts==="videoediting",Lr=ts==="cinematography";return e.jsxs("div",{className:"min-h-screen p-3 sm:p-6",children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-4 sm:space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 w-full",children:[h!=="news_admin"&&e.jsx(P,{onClick:()=>f("students"),variant:l==="students"?"default":"outline",className:`w-full shadow-md border border-white/20 active:bg-admin active:text-white ${l==="students"?"bg-admin hover:bg-admin/90":""}`,children:t("studentPanelButton")}),h!=="student_admin"&&e.jsx(P,{onClick:()=>f("management"),variant:l==="management"?"default":"outline",className:`w-full shadow-md border border-white/20 active:bg-admin active:text-white ${l==="management"?"bg-admin hover:bg-admin/90":""}`,children:t("managementToggleLabel")}),e.jsxs(P,{onClick:gr,variant:"outline",className:"w-full gap-2 shadow-md border border-white/20 active:bg-white active:text-admin",children:[e.jsx(cn,{className:"w-4 h-4"}),"Sign Out"]})]}),l==="students"&&h!=="news_admin"?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"p-4 sm:p-6 shadow-lg",children:e.jsxs("form",{onSubmit:Nr,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ut,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold flex-1 text-left text-primary",children:t(J?"editAllGradesTitle":"addGradesTitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center sm:items-start justify-center sm:justify-start",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-3 sm:gap-4 text-center sm:text-left",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[R?e.jsx("img",{src:R,alt:"Preview",onClick:()=>Y(R),className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full object-cover border-4 border-admin"}):e.jsxs("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-muted flex items-center justify-center border-4 border-admin relative",children:[e.jsx("span",{className:"absolute inset-0 rounded-full animate-ping bg-admin/20"}),e.jsx(ct,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:vr,className:"hidden"})]}),e.jsx("div",{className:"flex flex-col text-xs sm:text-sm text-admin",children:e.jsxs("div",{className:"flex items-center gap-1 hover:underline",children:[e.jsx(Ps,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:t("uploadPhoto")})]})})]}),e.jsxs("div",{className:"mt-2 sm:mt-0 sm:ml-2 flex gap-2",children:[e.jsxs(P,{type:"button",size:"sm",variant:Ge==="cinematography"?"default":"outline",onClick:()=>Ct("cinematography"),className:Ge==="cinematography"?"bg-admin hover:bg-admin/90 flex items-center gap-2":"flex items-center gap-2",disabled:Mr,children:[e.jsx(dn,{className:"w-4 h-4"}),e.jsx("span",{children:"Cinematography"})]}),e.jsxs(P,{type:"button",size:"sm",variant:Ge==="videoediting"?"default":"outline",onClick:()=>Ct("videoediting"),className:Ge==="videoediting"?"bg-admin hover:bg-admin/90 flex items-center gap-2":"flex items-center gap-2",disabled:Lr,children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:"Vision & Sound Editing"})]})]})]}),e.jsxs("div",{className:"flex-1 w-full grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(G,{type:"text",value:N.studentId,onChange:i=>I({...N,studentId:i.target.value.toUpperCase()}),placeholder:t("studentIdPlaceholder"),className:"uppercase",required:!0}),e.jsx(G,{type:"text",value:N.name,onChange:i=>I({...N,name:i.target.value}),placeholder:t("studentNamePlaceholder"),required:!0}),e.jsx(G,{type:"text",value:N.batchNumber,onChange:i=>I({...N,batchNumber:i.target.value}),placeholder:t("batchNumberPlaceholder")}),e.jsx(G,{type:"text",value:N.password,onChange:i=>I({...N,password:i.target.value}),placeholder:"Password",className:"font-mono"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground block",children:t("genderLabel")}),e.jsxs(it,{value:N.gender,onValueChange:i=>I({...N,gender:i}),children:[e.jsx(Ze,{className:"w-full","aria-label":t("genderLabel"),children:e.jsx(lt,{placeholder:t("genderPlaceholder")})}),e.jsxs(Qe,{children:[e.jsx(le,{value:"Male",children:t("genderMale")}),e.jsx(le,{value:"Female",children:t("genderFemale")})]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-sm",children:t("subjectsAndGrades")}),e.jsxs("div",{className:"flex gap-2",children:[w&&e.jsxs(P,{type:"button",onClick:()=>{p(!1),y(""),Oe(!1),I({studentId:"",name:"",batchNumber:"",gender:"",password:""}),D([{subject:"",grade:"",outOf:"",isCustom:!1,course:nt()}]),L(""),A(null),ss(null)},size:"sm",variant:"outline",className:"text-destructive border-destructive",children:[e.jsx(dt,{className:"w-4 h-4 mr-1"}),t("cancel")]}),e.jsxs(P,{type:"button",onClick:Sr,size:"sm",variant:"outline",className:"text-admin border-admin",children:[e.jsx(ut,{className:"w-4 h-4 mr-1"}),t("addSubject")]})]})]}),_.map((i,b)=>e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"w-1 bg-admin rounded-full flex-shrink-0 self-stretch"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground block mb-1",children:t("subjectNameLabel")}),e.jsxs(it,{value:i.isCustom?cs:i.subject||void 0,onValueChange:j=>Pr(b,j),children:[e.jsx(Ze,{className:"w-full",children:e.jsx(lt,{placeholder:"Select subject"})}),e.jsxs(Qe,{children:[Rr.map((j,T)=>j===Tt?e.jsx(fs,{},`divider-${T}`):e.jsx(le,{value:j,children:j},`${j}-${T}`)),e.jsx(fs,{}),e.jsx(le,{value:cs,children:"Custom Subject / Exam"})]})]},`${i.subject}-${i.isCustom}-${b}`)]}),i.isCustom&&e.jsx(G,{type:"text",value:i.subject,onChange:j=>os(b,"subject",j.target.value),placeholder:"Enter custom subject or exam name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground block mb-1",children:t("gradeLabel")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{type:"number",value:i.grade,onChange:j=>os(b,"grade",j.target.value),placeholder:t("gradeLabel"),min:"0",className:"w-24"}),e.jsx("span",{className:"text-muted-foreground font-bold",children:"/"}),e.jsx(G,{type:"text",value:i.outOf,onChange:j=>os(b,"outOf",j.target.value),placeholder:t("outOfLabel"),className:"w-24"})]})]})]}),_.length>1&&e.jsx(P,{type:"button",variant:"ghost",size:"sm",onClick:()=>_r(b),className:"text-destructive mt-6",children:e.jsx(dt,{className:"w-4 h-4"})})]},b))]})]}),e.jsx(P,{type:"submit",className:"w-full bg-admin hover:bg-admin/90",children:t(J?"updateGrades":"saveGrades")})]})}),(()=>{const i=g.flatMap(b=>(b.comments||[]).filter(j=>j.sender_type==="student"&&!j.is_read&&!as.includes(j.id)).map(j=>({...j,studentName:b.name,student:b}))).sort((b,j)=>new Date(j.created_at).getTime()-new Date(b.created_at).getTime());return e.jsxs(Ie,{className:"p-4 sm:p-6 shadow-lg border-l-4 border-l-red-500",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(is,{className:"w-5 h-5 text-primary shrink-0"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-primary",children:t("recentComments")}),i.length>0&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full animate-pulse flex items-center justify-center shrink-0",children:[i.length," ",t("newLabel")]})]}),i.length>0&&e.jsx(P,{variant:"outline",size:"sm",className:"text-xs h-8 px-3",onClick:async()=>{const b=i.map(U=>U.id),{error:j}=await k.from("comments").update({is_read:!0}).in("id",b);if(j){console.error("Error clearing comments:",j),v.error(`Failed to clear comments: ${j.message}`);return}const T=[...as,...b];Fs(T),localStorage.setItem("dismissedComments",JSON.stringify(T)),Ne(),v.success("All messages cleared")},children:t("clearAll")})]}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:i.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:t("noNewComments")}):i.map(b=>e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg border border-border flex justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-sm",children:b.studentName}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",b.student_id,")"]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:new Date(b.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-2",children:b.message})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(P,{size:"icon",variant:"ghost",className:"h-7 w-7 text-muted-foreground hover:text-destructive",onClick:async()=>{const{error:j}=await k.from("comments").update({is_read:!0}).eq("id",b.id);if(j){console.error("Error dismissing comment:",j),v.error("Failed to dismiss");return}const T=[...as,b.id];Fs(T),localStorage.setItem("dismissedComments",JSON.stringify(T)),Ne(),v.success("Message removed")},children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx(P,{size:"sm",className:"h-7 text-xs bg-admin hover:bg-admin/90",onClick:()=>{E(b.student)},children:t("reply")})]})]},b.id))})]})})(),ae&&e.jsx(we,{open:!!ae,onOpenChange:()=>M(""),children:e.jsxs(ve,{className:"max-w-2xl",children:[e.jsx(Se,{children:e.jsx(_e,{children:"Crop Image"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(At,{crop:q,onChange:i=>Z(i),onComplete:i=>he(i),aspect:1,circularCrop:!0,children:e.jsx("img",{ref:O,src:ae,alt:"Crop",className:"max-h-96 mx-auto"})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(P,{variant:"outline",onClick:()=>M(""),children:"Cancel"}),e.jsx(P,{onClick:jr,className:"bg-admin hover:bg-admin/90",children:"Apply Crop"})]})]})]})}),e.jsxs(Ie,{className:"p-4 sm:p-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-primary",children:[t("allStudents")," (",Us.length,")"]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{type:"button",size:"sm",variant:ge==="cinematography"?"default":"outline",onClick:()=>St("cinematography"),className:ge==="cinematography"?"bg-admin hover:bg-admin/90":"",children:"Cinematography"}),e.jsx(P,{type:"button",size:"sm",variant:ge==="videoediting"?"default":"outline",onClick:()=>St("videoediting"),className:ge==="videoediting"?"bg-admin hover:bg-admin/90":"",children:"Vision & Sound Editing"}),e.jsx(P,{type:"button",size:"sm",variant:ge==="all"?"default":"ghost",onClick:()=>St("all"),children:"All"})]}),e.jsxs("div",{className:"relative flex-1 sm:w-72",children:[e.jsx(un,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(G,{type:"text",placeholder:t("searchPlaceholder"),value:oe,onChange:i=>me(i.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 w-full sm:min-w-[540px]",children:[e.jsxs(it,{value:ie,onValueChange:F,children:[e.jsxs(Ze,{className:"w-full",children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),e.jsx(lt,{placeholder:t("filterGradesLabel")})]}),e.jsxs(Qe,{children:[e.jsx(le,{value:"all",children:t("filterGradesLabel")}),e.jsx(le,{value:"a+",children:"A+ (95-100%)"}),e.jsx(le,{value:"a",children:"A (92-94.99%)"}),e.jsx(le,{value:"a-",children:"A- (89-91.99%)"}),e.jsx(le,{value:"b+",children:"B+ (86-88.99%)"}),e.jsx(le,{value:"b",children:"B (83-85.99%)"}),e.jsx(le,{value:"b-",children:"B- (80-82.99%)"}),e.jsx(le,{value:"c+",children:"C+ (77-79.99%)"}),e.jsx(le,{value:"c",children:"C (74-76.99%)"}),e.jsx(le,{value:"non_compitant",children:"NON CMPITANT (Below 74%)"})]})]}),e.jsxs(it,{value:z,onValueChange:re,children:[e.jsxs(Ze,{className:"w-full",children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),e.jsx(lt,{placeholder:t("filterBatchLabel")})]}),e.jsxs(Qe,{children:[e.jsx(le,{value:"all",children:t("filterBatchLabel")}),Er.map(i=>e.jsx(le,{value:i,children:i},i))]})]}),e.jsxs(it,{value:W,onValueChange:Q,children:[e.jsxs(Ze,{className:"w-full",children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),e.jsx(lt,{placeholder:t("filterGenderLabel")})]}),e.jsxs(Qe,{children:[e.jsx(le,{value:"all",children:t("genderAllOption")}),e.jsx(le,{value:"Male",children:t("genderMale")}),e.jsx(le,{value:"Female",children:t("genderFemale")})]})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[600px] border-collapse",children:[e.jsx("thead",{className:"border-b border-t bg-muted/20",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"py-3 px-4 font-semibold text-sm border-r border-border",children:t("photoColumn")}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm border-r border-border",children:t("idColumn")}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm border-r border-border",children:t("nameColumn")}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm border-r border-border",children:t("batchColumn")}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm border-r border-border",children:"Password"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm border-r border-border",children:t("subjectsColumn")}),ns.show_admin_avg_grades&&e.jsxs("th",{className:"py-3 px-4 font-semibold text-sm border-r border-border text-center w-[140px] cursor-pointer hover:bg-muted/50",onClick:()=>mr(i=>i===null?"desc":i==="desc"?"asc":null),children:[t("avgGradeColumn"),Mt==="asc"&&e.jsx("span",{className:"ml-1",children:"â†‘"}),Mt==="desc"&&e.jsx("span",{className:"ml-1",children:"â†“"})]}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm text-center w-24",children:e.jsxs(zs,{modal:!1,children:[e.jsx(Hs,{asChild:!0,children:e.jsxs(P,{variant:"ghost",size:"sm",className:"h-8 w-full px-0 font-semibold hover:bg-transparent",children:[t("gradeLetterColumn"),e.jsx(Ss,{className:"ml-1 h-4 w-4"})]})}),e.jsxs(Gs,{align:"center",children:[e.jsx(Lt,{onClick:()=>Bs(!0),children:t("gradeLetterOnAll")}),e.jsx(Lt,{onClick:()=>Bs(!1),children:t("gradeLetterOffAll")})]})]})}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm text-center w-28",children:t("viewColumn")}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm text-center w-20",children:t("lockColumn")}),e.jsx("th",{className:"py-3 px-4 font-semibold text-sm text-center w-20",children:t("deleteColumn")})]})}),e.jsx("tbody",{className:"divide-y",children:Ir.map(i=>{const b=i.grades||[],j=ge==="all"?b:b.filter(B=>(B.course||"").toLowerCase()===ge.toLowerCase()),T=j.length>0?It(j.map(B=>B.grade)):0,U=j.length>0||!!i.course;return e.jsxs("tr",{className:"hover:bg-muted/30 transition-colors border-b",children:[e.jsx("td",{className:"py-3 px-4 border-r border-border align-middle",children:i.photo_url?e.jsx("img",{src:i.photo_url,alt:i.name,className:"w-10 h-10 rounded-full object-cover mx-auto"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center mx-auto",children:e.jsx(ct,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsx("td",{className:"py-3 px-4 font-mono text-xs sm:text-sm border-r border-border align-middle",children:i.student_id}),e.jsx("td",{className:"py-3 px-4 border-r border-border align-middle",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:i.name}),i.comments&&i.comments.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(is,{className:"w-3 h-3"}),i.comments.length," comment",i.comments.length>1?"s":""]})]})}),e.jsx("td",{className:"py-3 px-4 text-sm border-r border-border align-middle",children:i.batch_number||"-"}),e.jsx("td",{className:"py-3 px-4 text-sm font-mono border-r border-border align-middle",children:i.password||"-"}),e.jsx("td",{className:"py-3 px-4 text-sm font-semibold text-admin border-r border-border align-middle",children:j.length}),ns.show_admin_avg_grades&&e.jsx("td",{className:"py-3 px-4 border-r border-border align-middle text-center w-[140px]",children:e.jsx("div",{className:"flex justify-center items-center w-full",children:j.length>0?e.jsxs("span",{className:`px-3 py-1 rounded-lg font-bold text-sm ${$s(T)} inline-flex items-center justify-center min-w-[90px]`,children:[T,"% ",ns.show_grade_letters&&i.show_final_grade_letter?Ft(T):""]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:t("noGrades")})})}),e.jsx("td",{className:"py-3 px-4 align-middle text-center",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Es,{checked:!!i.show_final_grade_letter,onCheckedChange:B=>fr(i.student_id,B),title:i.show_final_grade_letter?"Turn off grade letters":"Turn on grade letters"})})}),e.jsx("td",{className:"py-3 px-4 align-middle text-center",children:U?e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>E(i),className:"text-admin border-admin hover:bg-admin/10 mx-auto w-[82px]",children:[e.jsx(Le,{className:"w-4 h-4 mr-1"}),t("viewButton")]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"-"})}),e.jsx("td",{className:"py-3 px-4 align-middle text-center",children:e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>xr(i.student_id,i.locked||!1),className:i.locked?"text-green-600 hover:text-green-600 hover:bg-green-50 mx-auto":"text-orange-600 hover:text-orange-600 hover:bg-orange-50 mx-auto",children:i.locked?e.jsx(sa,{className:"w-4 h-4"}):e.jsx(us,{className:"w-4 h-4"})})}),e.jsx("td",{className:"py-3 px-4 align-middle text-center",children:e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>kr(i.student_id,i.name),className:"text-destructive hover:text-destructive hover:bg-destructive/10 mx-auto",children:e.jsx(Xe,{className:"w-4 h-4"})})})]},i.student_id)})})]})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[h==="super_admin"&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"p-4 border-l-4 border-l-orange-500 bg-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"p-2 bg-primary rounded-full flex-shrink-0",children:e.jsx(Ot,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h3",{className:"font-bold text-primary",children:t("superAdminAccess")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("manageMasterPassword")})]}),e.jsxs(P,{onClick:()=>rt(!0),variant:"outline",className:"gap-2 text-admin border-admin hover:bg-admin hover:text-white",children:[e.jsx(Me,{className:"w-4 h-4"}),t("changePassword")]})]})}),e.jsx(Ie,{className:"p-4 border-l-4 border-l-orange-500 bg-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"p-2 bg-primary rounded-full flex-shrink-0",children:e.jsx(Ot,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h3",{className:"font-bold text-primary",children:t("newsAdminAccess")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("manageNewsAdminAccess")})]}),e.jsxs(P,{onClick:()=>Wt(!0),variant:"outline",className:"gap-2 text-admin border-admin hover:bg-admin hover:text-white",children:[e.jsx(Me,{className:"w-4 h-4"}),t("changePassword")]})]})}),e.jsx(Ie,{className:"p-4 border-l-4 border-l-orange-500 bg-white shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"p-2 bg-primary rounded-full flex-shrink-0",children:e.jsx(Ot,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h3",{className:"font-bold text-primary",children:t("studentAdminAccess")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("manageStudentAdminAccess")})]}),e.jsxs(P,{onClick:()=>Jt(!0),variant:"outline",className:"gap-2 text-admin border-admin hover:bg-admin hover:text-white",children:[e.jsx(Me,{className:"w-4 h-4"}),t("changePassword")]})]})}),e.jsx(go,{}),e.jsx(no,{})]}),e.jsx(oo,{}),h==="super_admin"&&e.jsxs(e.Fragment,{children:[e.jsx(uo,{}),e.jsx("div",{className:"mt-8",children:e.jsx(ho,{})}),e.jsx(mo,{}),e.jsx(po,{})]})]})})]}),e.jsx(we,{open:m!==null,onOpenChange:()=>{E(null),H(!1)},children:e.jsxs(ve,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Se,{children:e.jsx(_e,{children:t("studentGradeReportTitle")})}),m&&m.grades&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[m.photo_url?e.jsx("img",{src:m.photo_url,alt:m.name,className:"w-14 h-14 rounded-full object-cover border-2 border-admin"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-muted flex items-center justify-center border-2 border-admin",children:e.jsx(ct,{className:"w-7 h-7 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold",children:m.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ID: ",m.student_id]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Password: ",e.jsx("span",{className:"font-mono font-bold text-black",children:m.password||"Not Set"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(P,{onClick:()=>Cr(m),className:"bg-admin hover:bg-admin/90 gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),t("editAllGradesTitle")]})})]}),(()=>{const i=vt.reduce((j,T)=>j+Number(T.grade||0),0),b=It(vt.map(j=>Number(j.grade)));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`border-2 border-admin rounded-lg p-3 ${$s(b)}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:t("totalSubjectsLabel")}),e.jsx("p",{className:"text-2xl font-bold",children:vt.length})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:t("totalGradeLabel")}),e.jsxs("p",{className:"text-2xl font-bold",children:[i,"%"]})]}),m.show_final_grade_letter&&e.jsx("div",{className:"inline-flex items-center justify-center h-9 px-3 rounded-md font-bold text-sm bg-white/20",children:e.jsx("span",{className:"text-white",children:Ft(i)})})]})]})}),e.jsx("div",{className:"mt-3",children:e.jsxs("button",{type:"button",onClick:()=>H(!$),className:"text-admin font-semibold inline-flex items-center gap-1 hover:underline",children:[t($?"hideAllResults":"showAllResults"),e.jsx("span",{className:`transition-transform ${$?"rotate-180":""}`,children:"â–¾"})]})})]})})(),$&&vt&&vt.length>0&&e.jsxs("div",{className:"mt-4 border-t border-muted pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hn,{className:"w-5 h-5 text-admin"}),e.jsx("h3",{className:"font-bold text-lg",children:t("allSubjectsAndGradesTitle")})]}),e.jsx("div",{children:e.jsxs(P,{onClick:wr,className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:[e.jsx(mn,{className:"w-4 h-4 mr-1"}),"Export"]})})]}),e.jsx("div",{className:"space-y-2",children:vt.map(i=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg border",children:[e.jsx("span",{className:"font-medium",children:i.subject}),e.jsxs("span",{className:"font-bold",children:[i.grade,i.total?` / ${i.total}`:"%"]})]},i.id??`${m.student_id}-${i.subject}`))})]}),m.comments&&e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(is,{className:"w-5 h-5 text-admin"}),e.jsx("h3",{className:"font-bold text-lg",children:"Comments"})]}),e.jsx("div",{className:"space-y-3 mb-4 max-h-60 overflow-y-auto",children:m.comments.length===0?e.jsx("p",{className:"text-center text-muted-foreground text-sm py-4",children:t("noMessagesYet")}):m.comments.map(i=>e.jsxs("div",{className:`p-3 rounded-lg group relative ${i.sender_type==="teacher"?"bg-admin/10 mr-8":"bg-muted ml-8"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:i.sender_type==="teacher"?`${t("youLabel")} (${t("teacherLabel")})`:t("studentLabel")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(i.created_at).toLocaleString()})]}),i.sender_type==="teacher"&&e.jsxs(zs,{children:[e.jsx(Hs,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-70 hover:opacity-100",children:e.jsx(pn,{className:"h-3 w-3"})})}),e.jsxs(Gs,{align:"end",children:[e.jsxs(Lt,{onClick:()=>{Rt(i),es(i.message)},children:[e.jsx(gn,{className:"mr-2 h-4 w-4"}),t("editMessage")]}),e.jsxs(Lt,{className:"text-red-600 focus:text-red-600",onClick:()=>Dr(i.id),children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),t("deleteMessage")]})]})]})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:i.message})]},i.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($t,{value:ue,onChange:i=>Pe(i.target.value),placeholder:t("replyPlaceholder"),className:"flex-1 min-h-[60px]"}),e.jsx(P,{onClick:()=>{Ar(m.student_id)},disabled:!ue.trim(),className:"bg-admin hover:bg-admin/90",children:e.jsx(xn,{className:"w-4 h-4"})})]})]})]})]})}),V&&e.jsx(we,{open:!!V,onOpenChange:()=>Y(""),children:e.jsx(ve,{className:"max-w-sm",children:e.jsx("div",{className:"flex items-center justify-center p-6 bg-blue-600 rounded-lg",children:e.jsx("img",{src:V,alt:"Preview",className:"w-48 h-48 rounded-full object-cover border-4 border-white"})})})}),e.jsx(xo,{open:gt,onOpenChange:rt}),e.jsx(fo,{open:Ts,onOpenChange:Wt}),e.jsx(wo,{open:As,onOpenChange:Jt}),e.jsx(we,{open:!!Zt,onOpenChange:i=>!i&&Rt(null),children:e.jsxs(ve,{children:[e.jsx(Se,{children:e.jsx(_e,{children:"Edit Message"})}),e.jsx($t,{value:Qt,onChange:i=>es(i.target.value),className:"min-h-[100px]"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(P,{variant:"outline",onClick:()=>Rt(null),children:"Cancel"}),e.jsx(P,{onClick:Tr,children:"Save Changes"})]})]})}),ir&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-2xl flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-admin/20 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-admin border-t-transparent rounded-full animate-spin"})]}),e.jsx("p",{className:"text-lg font-semibold text-admin animate-pulse",children:"Saving..."})]})})]})};export{Eo as AdminView};
